---
layout: post
title: Rで大きなサイズのベクトルをdgCMatrixに変換する
date: 2019-02-15 03:38:39
categories: r
---
<p>お世話になります。初歩的な質問で恐縮ですが、大きなデータを扱う上で計算時間が掛かり過ぎる問題が解決できずにいるのでアドバイスいただけたら幸いです。<br>
やりたいこととしては、</p>

<pre><code>v &lt;- c(1,5,10,1,2,4)
names(v) &lt;- c("a1_b1","a1_b8","a2_b3","a3_b1","a3_b2","a4_b7")
library(Matrix)
mat &lt;-  Matrix(0,nrow=4,ncol=8)
rownames(mat) &lt;- paste("a",seq(1,4),sep="")
colnames(mat) &lt;- paste("b",seq(1,8),sep="")
</code></pre>

<p>このベクトルvを疎行列matにマッピングしたいと考えています。ほしい結果は</p>

<pre><code>   b1 b2 b3 b4 b5 b6 b7 b8
a1  1  .  .  .  .  .  .  5
a2  .  . 10  .  .  .  .  .
a3  1  2  .  .  .  .  .  .
a4  .  .  .  .  .  .  4  . 
</code></pre>

<p>のような行列です。</p>

<p>当初は<br>
① forループでa1~a4まで繰り返し操作<br>
② i=1のときvの中からa1に相当する要素（この場合はc(1,5)）を抽出<br>
③ 要素数8、値0の空のベクトルX（添字b1~b8）を作成し、②で取得した要素を対応する添字（今回はb1,b8）にマッピング<br>
④ XをdgCMatrixに変換<br>
⑤ ②〜④をi=4まで繰り返す、作成したXは順次rowbindしていく<br>
という手法を取っていましたが、データサイズが大きくなると現実的な時間では終わりません（実際はvは5000万要素あります）。</p>

<p>②の部分（抽出）に多くの時間がかかっているようなので、for文ではなくapplyなどでまとめて処理したいと考えていますがアイデアが思いつきません。<br>
わかりにくい文章で恐縮ですがお助けいただければ嬉しいです。</p>
