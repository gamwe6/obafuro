---
layout: post
title: MAX値を記録した他のフィールド取得
date: 2018-04-15 00:18:42
categories: sql
---
<p>Microsoft SQL Server 2012を使っています。</p>

<p>例えば以下のようなレコードをもつテーブルがあるとします。<br>
レコードは10分毎の1ヶ月分のデータになります。(4032Row)<br>
DateTime, Value1, Value2<br>
2018-02-01 00:10:00 0.3 0.3<br>
2018-02-01 00:20:00 0.3 0.6<br>
2018-02-01 00:30:00 0.5 1.1<br>
2018-02-01 00:40:00 0.2 1<br>
2018-02-01 00:50:00 0.4 1.1<br>
2018-02-01 01:00:00 0.1 0.7<br>
...<br>
2018-02-28 24:00:00 0.1 0.7</p>

<p>ここで行いたいことは<br>
「毎日のValue2の最大値とその時間を返す」ことです。</p>

<p>例えば、上の例だった場合 2/1のValue2の最大値が1.1であった場合、クエリの戻り値は<br>
2018-02-01 00:30:00 0.5 1.1<br>
であってほしいです。<br>
Value2に1.1が複数ある場合は最初のレコードを最大値を記録した最初のレコードとして、DateTimeフィールド、Value1フィールドの値を受け取ります。</p>

<p>ここで試してみたクエリは以下の通りでした。</p>

<pre class="lang-SQL prettyprint-override"><code>SELECT FORMAT(DateTime, 'yyyyMMdd'), MAX(dblValue2) 
FROM TableA  
Group BY FORMAT(DateTime, 'yyyyMMdd')
```

<p>これだと各日のMAX値は取れたのですが、そのMAX値を記録した日付が取得できませんでした。。</p>

<p>どなたか、解決するための良いクエリのご教授よろしくお願いします。</p>

<p>※WHILEで以下にもCみたいにプログラマブルに書けば解決はできるのですが…<br>
せっかくなのでクエリで解決したいです。</p>
