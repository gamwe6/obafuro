---
layout: post
title: 不定期なバッチ処理（リクエストが行われた日時のみ実行）を実装したいです。(wheneverのようなgemを用いて。)
date: 2016-07-30 10:30:02
categories: ruby-on-rails ruby
---
<p>次のようなバッチ処理を実装したいと思ってます。<br>
但し、一日一回みたいな定期的なものではなく、あくまでリクエストが行われた時のみです。<br>
そのため、多い日は一日5回バッチ処理が走ることがあったり、逆に一日一回実行されない日もあります。</p>

```
画面上から実行したい日時を入力し、リクエストを送信
↓
その時間帯になると、バッチ処理が起動
```

<p>定期的なバッチ処理をRailsで実現するには<br>
<code>whenever</code>というgemがよさそうでした。</p>

<p>ただ、前述のとおり、不定期なバッチ処理を実現するためにはどのような設計をすればできるのかわからず質問させて頂きました。</p>

<p>また、cronに毎時実行で登録し、リクエストが来ているかどうかをチェックするためのバッチ処理と、リクエストがあった場合のバッチ処理との2つにわけるという方法も考えたのですが、あまりいい設計ではない気がしましたため、他にいい方法があればそちらをもとに設計したいなと思います。</p>

<p>よろしくお願いします。</p>

<p>※ 以下のようなイメージで実現できればなと考えております。</p>

```
# params[:batch_requests] には複数の日時が入る

every params[:batch_requests] do
  rake 'my:rake:task'
end
```

<p>尚、こちらにも、質問をさせていただいております。<br>
ご了承の程よろしくお願いします。<br>
<a href="https://teratail.com/questions/42781" rel="nofollow">https://teratail.com/questions/42781</a></p>
