---
layout: post
title: "apache+Passenger+Railsのリクエスト処理時間が長すぎる"
date: 2015-11-20 02:12:49
categories: ruby-on-rails apache
---
<p>初めて質問を投稿させて頂きました。宜しくお願いします！</p>

<h1>環境</h1>

<ul>
<li>Apache/2.2.15 (Unix)</li>
<li>Phusion Passenger version 4.0.42</li>
<li>Rails 3.2.18</li>
</ul>

<p>質問させて頂きたいのはタイトルの通りなのですが、原因がわからず困っています。<br>
apacheのTimeoutは120秒に設定しているのですが、本当に極稀に予期せぬ不具合が発生し、原因を調べてみると、<br>
apacheのアクセスログが</p>

<blockquote>
  <p>[19/Nov/2015:07:35:37 +0900] "GET /XXX HTTP/1.1" 200  6 6369825<br>
  [19/Nov/2015:07:30:34 +0900] "GET /XXX HTTP/1.1" 200  7201 7201738623<br>
  [19/Nov/2015:09:45:02 +0900] "GET /XXX HTTP/1.1" 200  3 3323601</p>
</blockquote>

<p>このようになっており、明らかに120秒を超えているにも関わらずStatusは200を返してしまっています。<br>
Railsの方のログを確認した所,呼ばれたアクションの最初の行のログが下記のようになっています。</p>

<blockquote>
  <p>[2015-11-19 07:35:38] Hoge#fuga called<br>
  [2015-11-19 09:30:34] Hoge#fuga called<br>
  [2015-11-19 09:45:03] Hoge#fuga called</p>
</blockquote>

<p>となっており、後続の処理も何もなかったかのようにきっちり完了してしまっています。<br>
つまり、07:30にapacheにきた通信が09:30になってから、いきなり何もなかったかのように<br>
正常に処理を行ったようなログになっております。</p>

<p>なぜこのような事が起きたのか？防ぐ手立てはないのか？<br>
些細な事でも構いませんのでご教授願えればと思います。</p>

<p>理想的には、120秒以上経過したリクエストは処理せず500などのエラーステータスを返せれば良いなと考えています。</p>

<p>宜しくお願いします。</p>
