---
layout: post
title: "Solr4.6のリクエストクエリの構文について"
date: 2015-04-09 09:32:33
categories: java apache solr
---
<p>Solrのリクエスト時に、複雑なクエリを投げるとなかなか思い通りに動かないので質問させてください。</p>

<p>たとえば、text_ngram ”製品” と、text_ngram ”説明” というフィールドがあります。</p>

<p>＿製品＿ / ＿説明＿＿<br>
X製品A-1 / X説明A-1<br>
X製品A-2 / X製品A-2<br>
X製品A-3 / X製品A-3<br>
X製品B-1 / X製品B-1<br>
Y製品B-2 / Y製品B-2<br>
Y製品C-2 / Y製品C-2<br>
Y製品C-3 / Y製品C-3<br>
Y製品C-4 / Y製品C-4</p>

<p>というデータが登録されていたとして、</p>

<p>製品:(X)-製品:(B)-製品:(1)</p>

<p>というクエリを投げると、</p>

<p>X製品A-2 <br>
X製品A-3</p>

<p>がマッチします。<br>
ですが、</p>

<p>製品:(X) AND ((-製品:(B)-製品:(1)) OR (-説明:(1)-説明:(2)))<br>
= X製品A-3 / X説明A-3</p>

<p>とするとき、このクエリでは検索できません。<br>
おそらく、条件句(AND OR NOT)を連続して使うことはできないようです。<br>
※ "AND NOT", "OR NOT"は使えます。<br>
この時、かろうじて期待値が返ってくるクエリが以下です。</p>

<p>製品:(X) AND ((*:* AND NOT 製品:(B) AND NOT 製品:(1)) OR (*:* AND NOT 説明:(1) AND NOT 説明:(2)))</p>

<p>いろいろ試したんですが、うまく検索できるクエリがこれしかありませんでした。<br>
デフォルトオペレータはORになっています。</p>

<p>もう少しスマートにかけないものでしょうか？<br>
複雑な検索を扱うので、</p>

<p>フィールド:(A B C)</p>

<p>等、まとめるのは無しです。</p>
