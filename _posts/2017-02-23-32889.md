---
layout: post
title: "Tabキーによるフォーカスとマウスクリックによるフォーカスを区別したい"
date: 2017-02-23 04:03:03
categories: javascript jquery
---
<p><code>&lt;input type="text"&gt;</code>で作成したテキストボックスの<code>focus</code>イベントで、Tabキーでフォーカスした場合と、マウスクリックでフォーカスした場合を区別したいです。</p>

<h2>やりたいこと</h2>

<p>整数をカンマ区切りで表示するテキストボックスを作ります。<br>
Excelと同様、フォーカスが入ったらカンマを消し、フォーカスが外れたらカンマを挿入します。<br>
マウスクリックでフォーカスしたら、カーソルをクリックした位置に設定します（Excel同様、カンマが消えた分、ずれてしまいますが、それは許容します）。<br>
<strong>Tabキーでフォーカスが入った場合には、テキストボックス内の文字列を全て選択状態</strong>にします。</p>

<p>マウスクリックでは「クリックした位置にカーソルセット」<br>
Tabキーフォーカスでは「文字列を全選択」<br>
これは、<code>&lt;input type="text"&gt;</code>でテキストボックスを作れば、デフォルトでそのように振る舞う、普通の仕様です。</p>

<h2>問題</h2>

<p>フォーカス時にカンマを消す処理は、jQueryを使って</p>

<pre><code>var value = $('#text').val().replcae(/,/g, '');
$('#text').val(value);
</code></pre>

<p>のように処理しています（実際のものとは若干異なりますが、jQueryの<code>val</code>メソッドで置換していることは同じで、そこが本質だと思っています）。</p>

<p>ただ、こうすると、テキストボックス内の文字列を選択していても、選択が解除されてしまいます。<br>
そのため、「もしTabキーによってフォーカスされたら、jQueryの<code>select</code>メソッドを呼んで、選択状態にする」という処理を作りたいのです。</p>

<p>何か方法は無いでしょうか？<br>
同じ目的が達成できれば、別のアプローチでも構いません。</p>
