---
layout: post
title: fileをデータごとに作り出すことはベストプラクティスか？file,io,pickle系処理の関係性とは？
date: 2018-07-20 06:54:48
categories: python pyqt pyside file
---
<!-- {% raw %} -->
<p><code>Qt</code>で開発をしている者です。<br>
　<strong>質問の動機</strong><br>
　例えば、大量のウィジェットが存在しており、その<a href="http://e-words.jp/w/%E3%82%A6%E3%82%A3%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88.html" rel="nofollow noreferrer">ウィジェット</a>ごとにデータが格納されているとします。極端な話、そのウィジェット毎に、保存データのファイルを作成するのは、処理としてはあり得ない方法でしょうか？<br>
　というのは、アプリを立ち上げた際に、一気にロードをするのではなくて、GUI上の何らかのアクションが生じた時に、そのウィジェットに対応したものを、その都度それに応じたファイルをロードするようにしたらいいのではないかと考えました。<br>
　今までは全ての情報を、シーケンスで一つ～三つのファイルにまとめてそれを取り出したいデータごとに吸い出していました。<br>
  a,b,cというファイルを、ひとつのアプリで、aのファイルを選べばaのデータが、bを選べばbのデータが、cを選べばcのデータがそれぞれ吸い出されるようにしていたのです。<br>
　しかし、今回、aをさらに分割し、aというデータが保持しているウィジェット１についての情報を、a-1ファイルへ、ウィジェット２についての情報をa-2ファイルへと、個別化してみたいと考えています。同様に、bが持っているウィジェット１についての情報は、b-1ファイルへ、以下略。<br>
　<br>
　ただ分割しまくるというのは、危険な行為のように思えてしまいます。自分には、ファイルは多くても三～四という先入観があり、<code>open</code>と<code>close</code>を繰り返し、後は名前に番号さえ入れてやれば、理論上は大量に増やせるのはわかります。</p>

<p>　データの永続化については保存と取り出しが出来ただけで感動していたのですが、かなり大切な部分だという意識が高まってきました。(お答え次第によってはすぐにしぼんでしまうかもしれませんが)<br>
　<strong>聞きたいこと</strong><br>
　プロフェッショナルな方達からすると、ファイルは用途に応じていくらでも作ったほうがよいのでしょうか？それとも、できるだけ少なくした方がよいでしょうか？ものの本などを見ても、ファイルの作り方、取り出し方などはよくみるのですが、</p>

<p>　「<strong>一つのアプリの、あるデータが保持しているすべての情報に対して、その情報を一定のルール区切り毎に（１０００のウィジェットが保有しているデータなら１０００のファイルを）分割して、その数だけ作成する事</strong>」</p>

<p>　は、worseな選択肢でしょうか。データベースはあまり利用したくないです。<br>
　ちなみに多分多くとも100~300になろうと思いますが、場合によってはファイルの量が増えすぎて、検索に支障が出て、かえって時間がかかったりしてしまいそうな気がしています。これはやめておいたほうがいいでしょうか？</p>

<hr>

<p>　<strong>ぼやき：seekについて</strong><br>
　ひょっとして、こういうことをしないで済むために、ファイルを全部読み込むことなく、部分的な高速アクセスを図る方法が、<code>seek</code>というものなのでしょうか？一回一回分割したファイルにアクセスするのではなく、特定のseek位置へ移動してから読み込むべきということでしょうか。File系列の話の際には、よく見るメソッドですけれども、今まで利用する機会がありませんでした。<br>
　こちらが使えるのならば、こちらを検討した方がいいでしょうか？よく使い方がわかりませんが、QFileも、保持中のデータをマップ化して、オフセット指定をして特定のデータのみにアクセスできるという方法があると耳にしたことがあります。こちらを検討したほうがいいかなぁともかんがえています。<a href="https://docs.python.jp/3/library/io.html?highlight=seek#io.IOBase.seek" rel="nofollow noreferrer">公式</a>を見ているのですが、ランダムアクセスサポートという事で、大きな間違いではなさそうです。しかし、<code>QDataStream</code>で登録しているのに、<code>QIODevice</code>しか<code>[seek][3]</code>メソッドはないし・・・。いろんなものがごぎゃまぜになっているデータのなかから<code>seek</code>するというのも、試さず嫌いで敬遠していました。質問も質問としてまとまる気にならず、実際自分は、<code>QFile</code>,<code>QIODevice</code>,<code>QDataStream</code>,<code>QTextStream</code>,<code>python</code>に引き直すと、<code>open()</code>,<code>io()</code>,<code>pickle()</code>?等の明確な違いがあまりわからず、教科書通りに処理していました。<br>
　　<br>
　<strong>ぼやきのあとで</strong><br>
　今改めて考えてみますと、<code>file</code>は、データが入っているポイントを探し当てる物。そしてそれにに焦点を当てるためのクラス。<code>io</code>系のメソッドは取り出された一枚のデータが書かれているシートを走査して、情報を書き込んだり、読み取るための、ある意味コピー機のフラッシュのような役目。次に、<code>pickle</code>等は、<code>io</code>がよみとった情報を、バイトコードやテキストファイルに変換し、<code>file</code>に埋め込む役目をしているという理解で問題ないでしょうか？とすると、<code>io</code>が<code>seek</code>メソッドをもつというのもわかります。しかし、<code>seek</code>は、<code>io</code>という段階にありながらも、情報をよみとれるというのがいまいちピンときません。読み取る相手がバイト列か単なるテキスト文字列かは、Dataの種類によって異なる気も致します。<br>
　初心者の頃からもやもやしてました。</p>

<p>　<strong>聞きたいこと２</strong><br>
 <strong>聞きたいこと</strong>で聞いたことを代わりに行うのがseekメソッドなのでしょうか？<br>
 <code>file</code>と、<code>io</code>,そして<code>pickle</code>等の永続化3点セットの関係性を、氷解させてくれるようないい説明、たとえ噺などはございませんか？</p>

<hr>

<p>　<strong>まとめ</strong><br>
　まとめると、自分のやろうとしているのは、<code>file</code>のような、データの入っている箱を選ぶ段階で、個別具体的にするべきか？あるいは、データの入っている箱を選ぶ段階ではなく、その箱を見付けた後で、その箱の中から都合の良いデータを選ぶ処理をするべきか？という話に要約されるのではないかなとおもうようになりました。一言でいうと、このような疑問になりますが、どなたか詳しい方おねがいいたします。</p>

<hr>

<pre><code>python 3.6.5 Pyside 1.2.4
</code></pre>

<p>　</p>

<p>　</p>
<!-- {% endraw %} -->
