---
layout: post
title: "HTTP1.1のパイプライン処理でサーバーがリクエストをどのくらい待てばいいか？"
date: 2015-02-02 04:10:52
categories: http
---
<p>HTTP1.1のサーバーサイドの実装をしています。<br>
パイプライン処理はGETやHEADが連続でくるということですが、パイプライン開始のトリガーが(私が調べた限り)ないため、最初のGETを受け取った後に次に来るGET(or HEAD)の対処が難しいと考えています。</p>

<p>GET /A.html\r\n<br>
\r\n<br>
GET /B.html\r\n<br>
\r\n<br>
GET /C.html\r\n<br>
\r\n</p>

<p>上記の場合、<br>
最初に「GET /A.html」を受け取っているので、サーバーはそのコンテンツを返すべきですが、<br>
もしこれが上記のようにパイプラインなら、二つ目の「GET B.html」が来る可能性があるのでrecv()で待機に入る必要があります。ですが、このrecv()はいつまでやるべきでしょうか？<br>
タイムアウトするまでだとしても、1秒とか待機していてはロスですし、短すぎてもまだクライアントサイドがデータ送信中の可能性があります。もしくは二つ目のGETが来ない可能性もあります。</p>

<p>あと、そもそものお話ですが、HTTP1.1のパイプラインは一般的によく使われているのでしょうか？<br>
最近のブラウザとサーバーでは実装されているようですが、<br>
ブラウザはデフォルトでパイプラインでコンテンツを取得しにいくのか、滅多にこのような取得方法は行われないのか、ご存じの方がいらしたら教えていただけると助かります。</p>

<p>(最初の1枚目のコンテンツはリクエストとレスポンスが1対1で、その中身をパイプラインで取得しにいく、という感じだと想像しています)</p>
