---
layout: post
title: DataGridによって、他のコントロールの描画が固まってしまうのを回避する方法はありますか？
date: 2017-03-17 07:33:12
categories: c# wpf xaml mvvm
---
<p>現在、WPF+XAML+MVVMでアプリケーションを開発しています。</p>

<p>WPFのDataGridコントロールは大量のデータをBindすると描画に時間がかかるという既知の問題(仕様…)があります。</p>

<p>そのため、仮想化(VirtualMode)の機能が提供されていますが、ある程度は速くなったものの、それでも画期的に速くはできませんでした。<br>
そこで割り切って、DataGridの描画中はインジケーターを表示して、ユーザーに可能な限り遅く見せないような工夫をしようと考えているのですが、<br>
UIスレッドがDataGridによって占有されるためか、インジケーターまで固まってしまう問題が発生します。</p>

<p><a href="https://i.stack.imgur.com/JnXRd.gif" rel="noreferrer"><img src="https://i.stack.imgur.com/JnXRd.gif" alt="サンプルプログラム"></a><br>
(↑検証用に作ったプログラムを動かしているところ。「実行」ボタンをクリックすると、画面右側のDataGridにBindします。この時、画面左側のインジケーターに見立てたImageコントロールのアニメーションが一瞬固まってしまいます)</p>

<p><a href="https://i.stack.imgur.com/3k7yL.png" rel="noreferrer"><img src="https://i.stack.imgur.com/3k7yL.png" alt="画像の説明をここに入力"></a><br>
(↑パフォーマンスプロファイラーの結果もUPします。DataGridのレイアウト処理だけで1秒かかり、UIスレッドが占有されてしまっています）</p>

<p>インジケーターを固まらないようにする、良いアイデアはございますでしょうか？<br>
UIスレッドを並列化できる方法があれば一番望ましいのですが...</p>

<p>サードパーティー製のDataGridを使うという方法もありますが(某C社などは30%速くなるみたいなことを謳っていたりもしますが)、標準のコントロールで済ませたいです。<br>
また、DataGridに大量のデータをBindする行為自体はマストです。データ量を減らせ等の御意見はあるかと思いますが…。</p>

<p>ご教示よろしくお願いいたします。</p>
