---
layout: post
title: "一分あたりのリクエスト数を調整できるようなスクリプトを作成したいです。（負荷テストツールのようなものを自作してみたい）"
date: 2016-07-14 14:44:56
categories: ruby python テスト
---
<p>負荷テストツールというのは世の中に既にたくさん存在してます。</p>

<p>そういうツールをどうやったら作れるのかなと思い、考えております。</p>

<p>rubyかpythonで実装したいと考えている(ひとまずrubyで)ため、<br>
まずは、<code>faraday</code>というライブラリを前提で考えておりました。</p>

<p>今回わからないのは、引数に渡された値によって、<br>
リクエスト数を調整するロジックについてです。</p>

<p>たとえば、<br>
・1分あたり1000回リクエストを投げたい<br>
・1分あたり800回リクエストを投げたい</p>

<p>といった細かな調整をするときに</p>

<pre><code>client = Faraday.new(:url =&gt; "http://localhost:4567")
res = client.get(1000) # 1000回の場合
</code></pre>

<p>といった風にしたいのです。</p>

<p>faradayに固執していないので、rubyで使えるライブラリで、今回の要件を満たせるものでしたら代替は可能です。</p>

<p>考えていたのは、</p>

<blockquote>
  <p>1) 1分あたりのリクエスト数を記録する # 仮に1分あたり1500回とする<br>
  2) その時間を基準として、今回リクエストを送りたい数で割り算をする # 1000回送りたい場合 2/3して調整する？</p>
</blockquote>

<p>この方法だと1分あたり1500回が毎回の結果として同じであれば良いのですが、前後幅が大きいとうまくいかないかなと思いました。</p>

<p>また、仮に1分間に2000回のリクエストを送りたいとなった場合どうするのか等も考えていて、手詰まってしました。</p>

<p>よろしくお願いします。</p>

<h1>追記</h1>

<p>今回やりたいこととしましては、<br>
「1分間に1000人がアクセスする」といったシナリオのテストができるようなプログラムを作ることなため、<br>
単一コネクションではなく、複数コネク‌​ションで処理することが前提でプログラムを実装したいです。</p>

<p>勝手ながら、今回の実装は実現してみたいので、マルチポストさせて頂きました。<br>
ご了承下さい。<br>
<a href="https://teratail.com/questions/41220?complete=" rel="nofollow">https://teratail.com/questions/41220?complete=</a></p>

<h1>追記 2016/07/15 18時30分</h1>

<p>レスポンスタイムについての言及がおおかったのですが、<br>
私が、レスポンスタイムを気にしている理由としましては、単一コネクション前提で考えてしまっていたためです。<br>
そのため、複数コネクションを前提とした際には、レスポンスタイムは気にしなくていいです。<br>
私の中で、コネクションの整理がついておらず、失礼しました。。</p>

<p>その上で、分からない点は複数コネクションにわけて、リクエストを送るのはスクリプトとしてどのように作成したらいいのでしょうか？です。</p>

<pre><code>1000.times.do
  client = Faraday.new(:url =&gt; "http://localhost:4567")
  res = client.get()
end
</code></pre>

<p>のようなものかと思っておりましたが、これは単一コネクションになるのかなと思い・・・。</p>
