---
layout: post
title: MySQL DBとのコネクションの確立とクローズのタイミングについて
date: 2018-11-09 10:22:56
categories: mysql
---
<p>現在、APIから情報を取得し、MySQLデータベースに保存するプログラムを書いています。ベースはpythonで、使用するドライバはmysql-connector-pythonです。</p>

<p>実行環境<br>
・DB: MySQL8.0<br>
・ドライバ: mysql-connector-python<br>
・対象API: 仮想通貨取引所の価格データ</p>

<p>そこで、DBとのコネクションの確立とクローズのタイミングについて疑問があります。</p>

<p>今回のAPIからデータを保存する流れでは、データ量が多いため、APIでデータ呼び出し->データ保存のサイクルを何度も回す流れになります。このとき、DBとのコネクションを確立させたままにして、APIからデータ取得->保存を繰り返すのが良いのか、または一回保存する度にコネクションの確立とクローズも一緒に行うのか、悩んでいます。<br>
上記を整理した図は以下になります。</p>

<ol>
<li>DBとのコネクション確立-> [API呼び出し->DBにデータ保存]を繰り返し ・・・コネクションは確立しっぱなし</li>
<li>[DBとのコネクション確立->API呼び出し->DBにデータ保存->DBとのコネクションクローズ]を繰り返し</li>
</ol>

<p>ググってみた限りでは、コネクションの確立とクローズは負荷が大きいので接続しっぱなしが良いという意見と、都度コネクションの確立とクローズをするのが一般的との2つの意見が出てきました。</p>

<p>ただ、それ以上の判断軸が判然としなかったので、こちらで質問させて頂きました。</p>
