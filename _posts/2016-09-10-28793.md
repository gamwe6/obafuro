---
layout: post
title: "集約を分解して永続化するための設計"
date: 2016-09-10 02:59:10
categories: java ドメイン駆動設計
---
<p>下記の質問に関連します。<br>
<a href="https://ja.stackoverflow.com/questions/28771/%e7%89%b9%e5%ae%9a%e3%81%ae%e3%83%91%e3%83%83%e3%82%b1%e3%83%bc%e3%82%b8%e3%82%84jar%e3%81%ab%e5%af%be%e3%81%97%e3%81%a6%e3%81%ae%e3%81%bf%e5%85%ac%e9%96%8b%e3%81%99%e3%82%8b%e5%8f%af%e8%a6%96%e6%80%a7%e8%a8%ad%e5%ae%9a%e3%81%af%e5%8f%af%e8%83%bd%e3%81%8b">特定のパッケージやjarに対してのみ公開する可視性設定は可能か？</a></p>

<p>DDDにおける集約は、その内部状態（集約に含まれるエンティティやEnum型フィールド等）は公開せず、ユースケース上必要となるメソッドのみを外部に公開します。<br>
しかし、永続化層ではその内部状態を調べてデータベースのテーブルにマッピングしなければなりません。<br>
永続化のために全ての内部状態を<code>public</code>メソッドで公開するのは避けたいので、何らかの制約のもとで内部状態を取得する仕組みを求めています。</p>

<p>目標とする隠蔽のレベルですが、最低限、「うっかり呼んでしまった」を防げれば良いと考えています。<br>
<code>public</code>メソッドになっていると、その集約オブジェクトの設計（どの<code>public</code>メソッドが“真の”<code>public</code>なのか）に関する知識が無ければ、「うっかり」呼んでしまいますが、何か特別な手続きを踏む必要性を取り入れれば、「うっかり」は防げます。</p>

<p>この条件下では、どのようなクラス設計が良いでしょうか。<br>
何か応用可能なデザインパターンなどありませんか？</p>
