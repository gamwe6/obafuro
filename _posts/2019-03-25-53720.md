---
layout: post
title: SQLで特定のグループに所属するユーザーの最新の投稿1件を取得したい
date: 2019-03-25 12:35:58
categories: sql
---
<p>下記のようなテーブル・データが有った場合、特定のグループに所属するユーザーそれぞれの最新の投稿を1件だけ取得したい、と考えています。</p>

<p>例えば、group「イ」(group.id 1)の場合、グループ「イ」に属するAさん・Dさん・Eさんそれぞれの最新の投稿を</p>

```
+---------+-----------+-----------+--------------------+
| user_id | user_name |  content  |     posted_at      |
+---------+-----------+-----------+--------------------+
|       1 | A         | contentA2 | 2019-3-25 15:25:00 |
|       4 | D         | contentD2 | 2019-3-25 17:00:00 |
|       5 | E         | contentE2 | 2019-3-25 17:05:00 |
+---------+-----------+-----------+--------------------+
```

<p>このように取得したいと考えています。</p>

<p>この場合、どのようなSQLにすれば良いのでしょうか?</p>

<p>ご教授よろしくお願いします。</p>

<hr>

<h2>テーブル・データ</h2>

<h3>users</h3>

```
+----+------+
| id | name |
+----+------+
|  1 | A    |
|  2 | B    |
|  3 | C    |
|  4 | D    |
|  5 | E    |
+----+------+
```

<hr>

<h3>groups</h3>

```
+----+------+
| id | name |
+----+------+
|  1 | イ   |
|  2 | ロ   |
+----+------+
```

<hr>

<h3>groups_users</h3>

```
+----+----------+---------+
| id | group_id | user_id |
+----+----------+---------+
|  1 |        1 |       1 |
|  2 |        2 |       1 |
|  3 |        2 |       2 |
|  4 |        2 |       3 |
|  5 |        1 |       4 |
|  6 |        1 |       5 |
+----+----------+---------+
```

<hr>

<h3>posts</h3>

```
+----+---------+-----------+--------------------+
| id | user_id |  content  |     posted_at      |
+----+---------+-----------+--------------------+
|  1 |       1 | contentA1 | 2019-3-25 15:00:00 |
|  2 |       2 | contentB1 | 2019-3-25 15:15:00 |
|  3 |       5 | contentE1 | 2019-3-25 15:15:00 |
|  4 |       3 | contentC1 | 2019-3-25 15:20:00 |
|  5 |       1 | contentA2 | 2019-3-25 15:25:00 |
|  6 |       4 | contentD1 | 2019-3-25 16:30:00 |
|  7 |       4 | contentD2 | 2019-3-25 17:00:00 |
|  8 |       5 | contentE2 | 2019-3-25 17:05:00 |
|  9 |       3 | contentC2 | 2019-3-25 17:30:00 |
| 10 |       2 | contentB2 | 2019-3-25 20:00:00 |
+----+---------+-----------+--------------------+
```
