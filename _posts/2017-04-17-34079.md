---
layout: post
title: DataStoreで同じKind内のEntityに一意な値をつけたい
date: 2017-04-17 23:30:38
categories: google-app-engine
---
<!-- {% raw %} -->
<p>DataStoreを使っているのですが、同じKind内のEntityにユニークな値を持たせたいと考えています。ただし対象のEntityには親のEntityがそれぞれあるものとします。</p>

<p>具体的に例をあげて説明させていただきます。<br>
例えばユーザとユーザの所持アイテムがあったとします。<br>
そして所持アイテムの親はユーザです。<br>
またこのアイテムは他のユーザに移譲できるものとします。</p>

<p>またそれぞれのアイテムは変化しないユニークな値を割りふりたいです。<br>
なぜならそのアイテムに紐付いているデータがあると想定されるためです。<br>
例えば移譲回数に限度があるや、アイテムの移動ログなどです。</p>

<p>私の認識ではアイテムの移譲を実現するためには、一度アイテムエンティティを消して、移譲先のユーザのエンティティにアイテムを作成することで実現できると考えています。</p>

<p>しかしこの方法だともしDataStoreにIDを自動で振らせていた場合、キーのIDが変更されてしまいます。<br>
しかしIDをこちらで指定してコピーすることはできません。<br>
なぜならエンティティグループが違うため、衝突する可能性があるためです。</p>

<p>RDBではAutoIncrementがテーブルごとにできるため、この様な問題は起こらないのですが、DataStoreではどの様にすればこの問題が解決できるかわかりません。</p>

<p>ご回答頂けると助かります。</p>
<!-- {% endraw %} -->
