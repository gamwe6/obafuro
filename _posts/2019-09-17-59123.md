---
layout: post
title: プライマリキーのカラムを取得し、値を結合したカラムを作成したい
date: 2019-09-17 11:26:33
categories: mysql sql
---
<p>MySQLについて質問です。</p>

<p>テーブルの主キーを取得し、値を結合したカラムを追加するということを1回のクエリで実現したいです。</p>

<p>以下のようなテーブルがあったとして、プライマリキーが'id'と'client_id'の2つだったとします。</p>

<pre><code>+------+-----------+-------+
| id   | client_id | name  |
+------+-----------+-------+
| A001 |         1 | userA |
| A002 |         2 | userB |
+------+-----------+-------+
</code></pre>

<p>プライマリキーの内容をカンマ区切りで結合した'result'というカラムを追加したいです。</p>

<pre><code>+------+-----------+-------+---------+
| id   | client_id | name  | result  |
+------+-----------+-------+---------+
| A001 |         1 | userA | A001,1  |
| A002 |         2 | userB | A002,2  |
+------+-----------+-------+---------+
</code></pre>

<p>2回のクエリでの実装は以下の手順で行えましたが、1クエリで実現する方法をご教授いただきたいです。</p>

<ol>
<li>INFORMATION_SCHEMA.COLUMNSからプライマリキーのリストを取得</li>
<li>1で取得したプライマリキーからテーブルをSELECTするSQLを構築、CONCAT_WS関数でresultカラムを作成</li>
</ol>

<p>以上です。よろしくお願いいたします。</p>
