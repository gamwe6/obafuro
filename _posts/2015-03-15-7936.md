---
layout: post
title: Goで、構造体の値返しとポインタ返しの使い分け
date: 2015-03-15 09:48:32
categories: go
---
<p>Goに限らないトピックかもしれません。</p>

<p>次のような、データベースからデータを読み込む関数(インライン展開されない)を利用する関数があったとします。返されたオブジェクトの生存期間はこの関数内のみとします。</p>

```
func doSomething() {
    // getUser()はDBから読み込んで結果を返す関数
    user, err := getUser()
}
```

<p>この時、<code>getUser()</code>の実装パターンとして、値返しのパターンとポインタ返しの２パターンが考えられます。</p>

<ul>
<li>ポインタ返しの場合</li>
</ul>

<p>構造体のコピーは発生しませんが、<code>doSomething()</code>を大量に呼ぶとGC対象オブジェクトがヒープにたまる。</p>

<ul>
<li>値返しの場合</li>
</ul>

<p>ヒープにオブジェクトは作成しないが、構造体のコピーが発生するのでポインタ返しより実行がやや遅い？</p>

<p>Goの場合、この使い分けはどこで判断するのがよいでしょうか？</p>
