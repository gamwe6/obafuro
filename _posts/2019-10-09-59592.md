---
layout: post
title: Fuel real_ip に HTTP_X_FORWARDED_FOR の値が入らない
date: 2019-10-09 07:56:50
categories: fuelphp amazon-elb
---
<!-- {% raw %} -->
<p>ELB 経由で接続する Fuel サーバーのコントローラの先頭に以下のようなログを仕込んだのですが</p>

<pre><code>    $ip = Input::real_ip();

    Log::error(print_r($_SERVER, true));
    Log::error($ip);
</code></pre>

<p>$_SERVER には</p>

<pre><code>[HTTP_X_FORWARDED_FOR] =&gt; xxx.xxx.xxx.xxx
</code></pre>

<p>と送信元アドレスが入っていたのですが</p>

<p>$ip に入っていたのは</p>

<pre><code>[REMOTE_ADDR] =&gt; yyy.yyy.yyy.yyy
</code></pre>

<p>と同じもの（ELBのアドレス）でした</p>

<p><a href="http://developer.wonderpla.net/entry/blog/engineer/FuelPHP/" rel="nofollow noreferrer">http://developer.wonderpla.net/entry/blog/engineer/FuelPHP/</a> <br>
この記事をよむと real_ip で HTTP_X_FORWARDED_FOR に値が入ってたら優先して取得してくれるとあるんですが、使い方がまずいのでしょうか</p>

<p>なぜ送信元が取得できないのかなにか可能性があったら教えていただきたいです</p>
<!-- {% endraw %} -->
