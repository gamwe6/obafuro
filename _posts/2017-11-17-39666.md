---
layout: post
title: オペランドサイズ、アドレスサイズとは？ 16bit演算を用意する意味は？ メモリサイズの制限とアドレスサイズの関係は？
date: 2017-11-17 22:43:02
categories: アセンブリ言語 x86
---
<p><a href="https://ja.stackoverflow.com/questions/22346/x64%e3%81%a7%e3%81%af32%e3%83%93%e3%83%83%e3%83%88%e6%95%b4%e6%95%b0%e3%81%a864%e3%83%93%e3%83%83%e3%83%88%e6%95%b4%e6%95%b0%e3%81%ae%e6%bc%94%e7%ae%97%e3%81%af%e3%81%a9%e3%81%a1%e3%82%89%e3%81%8c%e9%ab%98%e9%80%9f">x64では32ビット整数と64ビット整数の演算はどちらが高速？</a> のページで</p>

<p>Sayuriさんの回答のコメントでEgtraさんが</p>

<blockquote>
  <p>x86/x86-64‌の32/64ビットモードでは、16ビット‌演算も、やはり32ビット命令より1バイト‌多く必要になります（オペランドサイズプリ‌フィックス）。</p>
</blockquote>

<p>とコメントしていたのですが、<br>
オペランドプリフィクスというのを知らなかったので調べた所、<br>
<a href="http://masahir0y.blogspot.jp/2013/04/blog-post.html" rel="nofollow noreferrer">このようなページ</a>が出てきました。</p>

<p>このページの下部の方に</p>

<blockquote>
  <p>ここで気が付くのは、同じ命令でも、違うコードが出ている。 <br>
  例えば、 mov (%esi), %eax は </p>
  
  <p>16bitでは、67668B06<br>
  32bitでは、8B06<br>
   64bitでは、678B06 となっている。</p>
  
  <p>67というのは、アドレスサイズプレフィックス 66というのは、オペランドサイズプレフィックス</p>
  
  <p>(省略)</p>
  
  <p>16bitモードでは、アドレスサイズ、オペランドサイズが16bitが基本。 67を付けるとアドレスサイズが32bitになる。<br>
  66を付けるとオペランドサイズが32bitになる。</p>
  
  <p>32bitモードでは、アドレスサイズ、オペランドサイズが32bitが基本。 67を付けるとアドレスサイズが16bitになる。<br>
  66を付けるとオペランドサイズが16bitになる。</p>
  
  <p>64bitモードでは、アドレスサイズ64bit、オペランドサイズ32bitが基本。 67を付けるとアドレスサイズが16bitになる。<br>
  66を付けるとオペランドサイズが16bitになる。 48を付けるとオペランドサイズが64bitになる。</p>
</blockquote>

<p>と書いてあり、ここでようやく1バイト増えるの意味が分かり、</p>

<p>「なるほど。64bitのプロセッサーでは16bit演算や64bit演算をする場合には、<br>
同じ命令でも66や48などのプリフィクスを付けるため、命令自体のサイズが1バイト増え、非効率になると言っていたのか」</p>

<p>となんとなく納得したのは良いものの、<br>
そもそものオペランドサイズ、アドレスサイズというのが私の理解で合っているのか分かりません。<br>
(そもそも上の鍵括弧内もあっているか怪しいですが)</p>

<hr>

<p>オペランドサイズはそのまま「被演算子となるデータ型のサイズ」の事をオペランドサイズと呼んでいるという事で良いのでしょうか？</p>

<p>もし、そうであるならば、16ビットモードの時代は、2**32以上の符号無し整数を扱う方法は無かったのでしょうか？</p>

<p>また、64ビットモードの場合などで、わざわざ命令のサイズを増やしてまで、<br>
オペランドサイズを16bitにする意味はあるのでしょうか？</p>

<p>それとも、命令のサイズを増やしても演算スピードが速くなる事はあるのですか？<br>
わざわざshort、byteを使う場面というのはあるのですか？</p>

<hr>

<p>アドレスサイズは、割り当てられるアドレスの数で、例えば32ビットOSならば、2**32しかアドレスを割り振れないから、<br>
4GBまでしかメモリを認識しなかった。</p>

<p>この理解であっているのでしょうか？</p>

<p>この理解であっている場合、64ビットOSでは2**64のアドレスを扱う事ができるはずですが、<br>
実際にはOSごとに扱えるメモリサイズは限られていると思います。</p>

<p>この場合、2**64で振られるアドレスの内、上位のビットはアドレスとして使わないという事になるのでしょうか？<br>
それとも、OSごとにアドレスサイズを変えているのでしょうか？<br>
(それだと、上の話のアドレスサイズ64bitが基本というのと合わない気がするので、これは多分違うとは思っている)</p>

<p>また、これもオペランドサイズの時と同じ質問ですが、<br>
わざわざ命令のサイズを大きくしてまで、アドレスサイズを16bitに縮小する意味があるのでしょうか？</p>

<p>それとも、命令のサイズを増やしても演算スピードが速くなる事はあるのですか？</p>
