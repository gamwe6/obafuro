---
layout: post
title: Railsのレスポンスで複数の画像ファイルを同時に返したい
date: 2018-01-08 07:24:53
categories: ruby-on-rails amazon-s3 react-native
---
<p>現在RailsとReactNativeを使ってモバイルアプリの開発をしています。</p>

<h2>やりたいこと</h2>

<p>サーバーサイドでs3からダウンロードした画像を、直接クライアントに複数枚まとめて送りたい。</p>

<h2>現在の実装</h2>

<p>クライアントからアップロードされた画像はS3に保存していて、保存した画像をクライアントに返す際はs3のpresigned_urlを返してクライアントサイドで読み取り、表示させています。</p>

<h3>現在の実装の問題点</h3>

<p>presigned_urlをクライアントに渡す方式だと、クライアントがRailsサーバーからのレスポンスを受取った後に再度presigned_urlに対してリクエストを送り、画像を取得する必要があります。<br>
この方式だと、まとめて10枚程度の画像を取得したい時に読み込みが完了するのにかなり時間がかかってしまいます。</p>

<h2>まとめ</h2>

<p>以上の点を踏まえて、s3からのファイルのダウンロードはRailsサーバーの方で済ませておいて、Railsサーバーからクライアントに直接ファイルを送る形式をとりたいです。（複数枚同時に）</p>

<p>send_fileのドキュメントを見ても複数枚画像を送るような方法が書かれていなかったため、何か良い方法をご存知であれば教えてください。</p>
