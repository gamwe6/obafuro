---
layout: post
title: JAX-RSを使ったWebアプリ上で非Beanクラスからセッションにアクセスしたい
date: 2015-07-31 04:07:10
categories: java jax-rs java-ee
---
<!-- {% raw %} -->
<p>JAX-RSを使ったWebアプリケーションを作っています。<br>
下記の条件を全て満たすクラスからセッションにアクセスできるようにしたいのですが、方法が分かりません。</p>

<ol>
<li>Beanではない任意の自作クラスである</li>
<li>引数によってセッションにアクセスするオブジェクト（例えばHttpServletRequest）を入手できない</li>
</ol>

<p>ASP.NETの場合、<code>HttpContext.Current</code>というstaticプロパティを経由して、いつでもセッション（やその他のHTTP関連オブジェクト）にアクセスできます。<br>
Java(JAX-RS)で同じような手段はありますか？</p>

<p>やろうとしていることは色々あるのですが、例えば「ログインユーザのIDをデータアクセス層の入り口（各プログラマに対して隠蔽された共通基盤内部）でロギングする」といったものです。<br>
ログインユーザの情報はセッションで保持しているのですが、この「共通基盤」と呼んでいるものは、<strong>JAX-RSのWebサービスとはクラス間の関連としては全くつながっていません</strong>。<br>
つまり、同じアプリケーション上に存在するクラスではありますが、クラス間依存の連なりとか、そういう意味での繋がりは全くありません。<br>
ですので、<code>HttpContext.Current</code>のように、グローバル変数のようなAPIがあれば助かります。</p>

<p><code>@SessionScoped</code>でDIを使う方法も考えられますが、これだと隠蔽された共通基盤の中に組み込めないように思います。</p>

<p>あるいは、WebサービスのRequestFilterで（もっと適したものがある？）セッションから情報を取り出し、どこか共通クラスのstaticなフィールドにコピーするという考えも一瞬浮かびましたが、全くスレッドセーフではないのでNGでした。<br>
ThreadLocalを使えば良いのかもしれませんが、ちょっと知識・経験不足で安全に実装できるかどうか、不安です。<br>
他に手段が無ければ色々と調査・検証した上で導入する必要がありますが・・・</p>

<p>何か良い方法は無いでしょうか？</p>

<p>環境は以下の通りですが、例えば「Spring Frameworkなら可」であれば、導入することも考えます。<br>
アプリケーションサーバ：WildFly<br>
使用フレームワーク：JavaEE7、Jersey(JAX-RS)</p>
<!-- {% endraw %} -->
