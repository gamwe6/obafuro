---
layout: post
title: 改行コード、¥r¥nや¥nに対応したsplit方法
date: 2017-06-25 02:33:06
categories: javascript
---
<p>こんにちは。<br>
JavaScriptで、シンプルな自分用のライブラリを作っています。<br>
コンパイル系の言語はよく使えるのですが、JavaScriptはまだ経験が浅いです。</p>

<p>改行で区切られた文字列に関する処理を行いたいと思っています。<br>
(名前が適切かどうかはともかくとしまして)</p>

<pre><code>var doc = new Document(改行含む文字列);
</code></pre>

<p>このような記述で、インスタンスを作り、行ごとにアクセスできるようなものを作りたいのです。<code>doc.getLine(i)</code>とか、<code>doc.setLine(i)</code>とか。</p>

<p>このときに、<code>¥r</code>、<code>¥n</code>、<code>¥r¥n</code>の全ての改行コードに対応したいなと思っています。<br>
<code>¥r¥n</code>は1行の空行、<code>¥n¥r</code>は2行の空行として扱いたいです。</p>

<p>例えば、ですが文字列が、次のようなものの場合</p>

<pre><code>'0123¥r456¥n789¥r¥n0123¥r¥r456¥n¥n789¥r¥n¥r¥n0123¥n¥r¥n¥r456'
</code></pre>

<p>配列に</p>

<pre><code>0123¥r
456¥n
789¥r¥n
0123¥r
¥r
456¥n
¥n
789¥r¥n
¥r¥n
0123¥n
¥r¥n
¥r
456
</code></pre>

<p>このような形で分解したいのです。<br>
※少し分解例を間違えていたので修正しました。<br>
単に <code>¥r</code>、<code>¥n</code>、<code>¥r¥n</code>、混在のテキストファイルに対しても読み込めるように処理をしたいと思ってます。<code>¥r</code>のテキストなんて実際にはほぼ存在しないとは思っています。<br>
また、'¥r¥n'を<code>¥n</code>、<code>¥r</code>を<code>¥n</code>にしてしまえば、全部¥nにして扱いやすそうですが、そのライブラリを使って何らかの加工をして戻す場合に、改行コードが勝手に変えられるのはライブラリの性質としてはちょっと残念だな、と思ってまして、どうせなら、改行コードが不一致しててもそのまま返してあげたいなと、そんな思いです。(ちょっと固執すぎかもしれません)</p>

<p>単純な<code>split</code>ではうまくいかないのは当たり前のことなのですが<br>
何か、シンプルで簡単な解決策などありますでしょうか。<br>
すでにどこかにこのようなコードはあるような気がしますが<br>
改行でSplitとかで検索しても<br>
たんに<code>¥n</code>でsplitする初心者向けの解決策がみつかるだけなので、検索でみつけることもできません。</p>

<p>文字列で先頭からサーチしていって<code>Array</code>に<code>push</code>かなにかをするのがいいのかな、と思っているのですが<br>
JavaScriptは文字列処理自体が遅いので、そのような処理が適切(スピードやシンプルさ)なのかが、わからなく、自信がもてないところではあります。</p>

<p>もっとよい解決策はあるのかな、もしかして正規表現の応用とかで高速に処理できるのかな、と思ってお聞きします。</p>

<p>何か、知見をお持ちの方に、例えば、すでにどこそこライブラリの実装があるよとか、書いたことあるから貼り付けるよとか、そういう情報を教えていただけますと助かります。<br>
よろしくおねがいします。</p>
