---
layout: post
title: Railsでfixtureを用いてテストデータを流し込む際のseed.rbとの連携について
date: 2019-01-20 10:56:36
categories: ruby-on-rails テスト
---
<p>こんにちは。最近Railsで開発し始めていて、疑問に思った点を質問します。</p>

<hr>

<h1>質問の概要</h1>

<p><code>db/seeds.rb</code> と <code>test/fixtures/**.yml</code>の連携方法を教えて欲しいです。<br>
あるいは、考え方の根本から間違っているのでしょうか……？</p>

<hr>

<h1>質問の詳細</h1>

<h3>前提となる自分の理解</h3>

<p><code>db/seeds.rb</code> は本番環境でも用いる初期データを流し込むためのファイル(= マスタデータの流し込み用スクリプト)、 <code>test/fixtures/**.yml</code> はテスト環境で用いるダミーデータを生成するためのファイルであるという認識をしています。</p>

<h3>実現したいこと</h3>

<p>例えば、会社の社員管理システムを立ち上げるとしましょう。単純に部署と社員を結びつけるだけのシステムだとします。</p>

<p>部署の一覧は開発段階で既に確定している上、本番環境でも初期データとして投入したいです。すなわち、 <code>db/seeds.rb</code> を使って流し込みを行いたいです。</p>

<p>一方、社員は開発段階ではまだ未定なので、開発・テスト用の社員を(Faker等を用いて)ダミーデータとして登録したいです。これは <code>test/fixtures/**.yml</code> を使って流し込むのが適切と考えます。</p>

<p>以上の用に開発・テスト環境を構築しようと考えました。</p>

<h3>分からなかったこと</h3>

<p>ここで、部署と社員を関連付ける方法が分かりませんでした。</p>

<p><code>test/fixtures/**.yml</code> のデータのみで関連付けるならばYAMLに <code>&lt;参照先モデル&gt;: &lt;参照データ名&gt;</code> と書けば良いと分かったのですが、 <code>db/seeds.rb</code> で生成されるデータと <code>test/fixtures/**.yml</code> 内のデータを関連付ける方法が分かりませんでした。</p>

<h3>お聞きしたこと</h3>

<p>「分からなかったこと」にある疑問を直接解決できる方法があるならばぜひ教えていただきたいです。</p>

<p>また、こういったことは不可能であるという場合、どのように対処するのが適切なのでしょうか。対処方法、あるいはポピュラーなgem等があるならば教えていただきたいです。</p>

<hr>

<p>説明が下手で長文となってしまいました。<br>
ご回答お待ちしております。</p>
