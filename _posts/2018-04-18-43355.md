---
layout: post
title: セキュアブート可能なlinuxカーネルイメージパッケージの作成方法
date: 2018-04-18 11:42:52
categories: linux ubuntu
---
<!-- {% raw %} -->
<p>Ubuntu16.04.4 LTSをMicrosoft Surface pro 3 で使用しています。<br>
<a href="https://ja.stackoverflow.com/questions/43264/%E7%84%A1%E7%B7%9Alan%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%B9%E3%82%92%E3%83%96%E3%83%AA%E3%83%83%E3%82%B8%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AB%E8%BF%BD%E5%8A%A0%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%9B%E3%82%93">無線LANインターフェスをブリッジインタフェースに追加できません。</a><br>
にある目的でカーネルを修正して.debパッケージを作成しようとしています。</p>

<p>まずは修正せずにパッケージをビルドしてインストール - ブートできるかを確認します</p>

<pre><code>$ apt source linux-image-4.13.0-38-generic
$ dpkg-buildpackage -B
</code></pre>

<p>これでカーネルイメージのパッケージが作成されました。<br>
つづいてパッケージをインストールします。</p>

<pre><code>$ sudo dpkg -i linux-image-4.13.0-38-generic_4.13.0-38.43~16.04.1_amd64.deb
</code></pre>

<p>インストールも無事成功し、ブートしましたがセキュアブートに阻まれてブートできませんでした。<br>
セキュアブートを無効にすればブートするでしょうが、Surfaceはセキュアブートを無効にすると<br>
真っ赤なパワーオンロゴを出すといういじわるをするのでセキュアブートは有効なままでブートしたいです。</p>

<p>ビルドしたカーネルをセキュアブートでブートするためには<br>
手順として、署名をする必要がありそうなことは想像つきます。<br>
おそらく想像するに<br>
　１．証明書と秘密鍵を自前で生成<br>
　2.署名する(おそらく *.koも)<br>
　3.証明書をUEFIにインストールする<br>
という手順が必要かと考えています。</p>

<p>しかし具体的にどういう操作をすればいいのか見当もつきません。<br>
ダウンロードしたソースのどこかに証明書と秘密鍵を置けば勝手にしてくれるのか…<br>
想像している手順を自前でしなくてなならないのか…</p>

<p>ちなみに、surfaceにubuntuをインストールしてVirtualBoxでゲストOS:Windows10を起動する<br>
といういびつな使い方をしています。<br>
VirtualBoxのドライバをmodprobeする際もセキュアブートに阻まれて<br>
<a href="https://askubuntu.com/a/900121">https://askubuntu.com/a/900121</a><br>
を参考に無事セキュアブートでもmodprobeできたという経験はあります。</p>

<p>質問：<br>
ビルドしたカーネルをセキュアブートでブートできるようにするにはどういう操作をすればよいのでしょうか？</p>
<!-- {% endraw %} -->
