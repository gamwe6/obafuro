---
layout: post
title: SQLでキーとなるデータがなければINSERTし、あれば該当キーのデータをUPDATEするような方法について
date: 2019-01-10 06:08:35
categories: sql csv データベース
---
<!-- {% raw %} -->
<p>お世話になります。</p>

<p>今までも過去に何度も出ている質問と思いますが、過去ログでも見つからなかったので<br>
質問いたします。</p>

<p>データベースの種類を問わず、ある既存のテーブルにCSVファイルをインポートする方法を<br>
検討しています。</p>

<p>特定のフィールドにキーがあり、CSV側のデータがテーブル側のキーに該当しない場合は<br>
新しい項目としてデータを追加(Import)、該当するキーがある場合はレコードの内容を<br>
更新(UPDATE)させたいのですが、その方法を『全てのデータベースで<br>
共通する方法』で行えればと思うのですが、そういった方法はありますでしょうか？</p>

<p>直接CSVと衝突させることができればベストなのですが、一度ダミーのテーブルにすべて<br>
インポートしてから比較して…という方法でも構いません。</p>

<p>まだ知識も浅いもので、今のやり方だと、コード側で一行ずつデータを取り出してあるかどうかを<br>
比較してからINSERTなりUPDATEなりをして…といったことをCSVの行数分ループさせて<br>
いるのですが、これだとどうしても膨大な時間がかかってしまいます(15万件)。</p>

<p>データベースに依存しない、共通のSQLの範囲でこれらの作業を一つ二つのSQLで<br>
行いたいのですが、そういった方法がありましたらご教授いただけますでしょうか。</p>

<p>よろしくお願いいたします。</p>
<!-- {% endraw %} -->
