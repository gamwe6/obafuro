---
layout: post
title: ドメイン駆動設計における in-memory Repository （オンメモリリポジトリ？）について
date: 2018-11-02 07:41:56
categories: ドメイン駆動設計
---
<p>現在、DDD でアプリケーションの作成を試みています。初めての取り組みなので、いろいろつまずいているのですが、首題の件で質問があります。</p>

<p>DDD では、状態の保持はリポジトリを用いて行うのかなという認識です。  <br>
その際、DB を用いずに、メモリ上で一時的に保存する必要がある場合の、 in-memory リポジトリ（オンメモリリポジトリ？）の実装方法について悩んでいます。</p>

<p>基本的にリポジトリで保存したり取得したりする対象は集約ルートになると思うのですが、集約ルートは参照型になると思います。  <br>
愚直に実装すると、参照型をそのままリポジトリ上に保持することになるので、取得時にオブジェクトの再構築が不要になります。（というか再構築のしようがない）  <br>
この場合、取得したオブジェクトの状態を変更すると、参照型でそのままオブジェクトを取得するため、オブジェクトがダイレクトに変更されます。</p>

<p>Web 上や IDDD 本に出てくる例では、<code>リポジトリはコレクションのようにして扱えるようにする</code> というのがよく挙がっています。つまり、 <code>Add</code> や <code>Update</code> など、明示的な API をコールしたときに初めてリポジトリが更新されるという認識です。  <br>
そのため、上記のダイレクトで変更が反映される点に違和感があります。</p>

<p>そこで、メモリ上に集約ルートを保存する場合の実装方法としては、どのようなやり方がよいのでしょうか。  <br>
ご助力いただければ助かります。宜しくお願い致します。</p>
