---
layout: post
title: "異常終了時、ダンプファイルの保存"
date: 2015-09-16 05:17:16
categories: c++ c windows
---
<p>Windowsアプリが不正な処理で異常終了するとき、</p>

<blockquote>
  <p>MyApplication は動作を停止しました<br>
  問題が発生したため、プログラムが正しく動作しなくなりました。プログラムは閉じられ、解決策がある場合はWindowsから通知されます。</p>
</blockquote>

<p>というメッセージが表示されます。</p>

<p>通常は、このタイミングで、Windowsタスクマネージャーを開き、当該プロセスを右クリックして、ダンプファイルの作成を実行することで、ダンプファイルを保存することができます。</p>

<p>このような人手による操作ではなく、プログラムによって、ダンプファイルを自動保存する方法はないでしょうか？</p>

<p>私のアプリは、ランチャ.exeとメイン.exeに分かれていて、ランチャ.exeが DEBUG_ONLY_THIS_PROCESS フラグ付きで、 CreateProcessを呼び、メイン.exeをデバッグ対象の子プロセスとして起動するようになっています。</p>

<p>異常終了が発生したとき、EXCEPTION_DEBUG_EVENTを捕まえることはできるのですが、このタイミングで、ダンプファイルを任意の場所に自動保存したいと思います。</p>

<ul>
<li>ダンプファイルのファイル構造は公開されているか？</li>
<li>ダンプファイルを作成するAPIは存在するか？</li>
</ul>

<p>以上、ご存じでしたらご教示ください。</p>
