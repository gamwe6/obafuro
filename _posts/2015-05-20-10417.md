---
layout: post
title: Windowsでバッチを実行するため、ジョブ機能(キュー)を利用したい
date: 2015-05-20 09:16:29
categories: batch-file
---
<p>Windows 7のデスクトップで、Handbrakeを用いて多数のビデオファイルのエンコーディングを行おうとしています。<br>
GUI版ではキューを利用したバッチ処理が可能ですが、プロファイルを利用しても多数のビデオを同じ設定でエンコードするには非常に手間がかかります。(具体的には、音声トラック指定やチャプターが引き継がれない上、ハングするとキューがリセットされてしまうため、再度設定しなおしになります)<br>
そこで、HandbrakeのCUI版を用いて、こちらでバッチ処理で一括エンコードをさせようと考えています。</p>

<p>しかし、CUI版にはキューが実装されていないため、エンコードが終わり次第、手動でエンコードを開始する必要があります。<br>
バッチでまとめて処理することも考えましたが、以下の問題があります。</p>

<p>・該当ファイルが数百あるため、バッチファイル内に処理対象を記入したり、ドラッグアンドドロップで対処しようとすると、抜け漏れが発生したことに気づかない恐れがある。<br>
・フォルダ内の一部のファイルのみがエンコード対象であるため、forを用いたフォルダ直下全てに対する処理ができない。(該当ファイルだけを一時的に作業用フォルダに移すことは環境上難しいです)<br>
・バッチから起動した場合、処理している途中でハングしてしまうと、どのファイルまで処理されたかがすぐには分からなくなってしまう。</p>

<p>そこで、ジョブ・キューによる実行を行いたいと考えました。<br>
想定する流れは以下の通りです。</p>

<p>・エンコードするコマンドをバッチ1として記述する。(済)<br>
・バッチ1に引数としてファイル名を与えたものをジョブとしてキューに登録するバッチ2を作る。<br>
・バッチ2にファイルをドラッグアンドドロップし、バッチ1+ファイル名をキューに追加する。<br>
・キューが空になるまでエンコードを行う。同時に実行されるHandbrakeは1つとし、1つのファイルのエンコードが終わったら次のファイルのエンコードを開始する。<br>
・キュー内のジョブは後から確認・追加・キャンセルを行える。</p>

<p>ただ、肝心のキューを実現する方法が分からず、どう実装すれば解決できるのか、途方に暮れています。<br>
Windows上で完結し、かつできるだけ簡便に、ジョブ・キュー機能を使ってエンコードするには、どのようにすればよいでしょうか。</p>
