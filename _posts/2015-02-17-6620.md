---
layout: post
title: ドメインモデルにおける集約ルートには、グローバル空間で一意なIDが必要？
date: 2015-02-17 05:52:34
categories: ドメイン駆動設計
---
<p>ドメインモデル（ドメイン駆動設計）では、集約ルートにはグローバル空間で一意なIDを付けるべし、という情報を得ました。<br>
DDD本にも、「（集約）ルートエンティティはグローバルな同一性を持つ」という記述があります。<br>
※ごめんなさい、電子書籍なのでページ番号分かりません。集約の不変条件についての記述です。<br>
このことについて疑問がありますので教えて下さい。</p>

<p>例えば、プロジェクト管理アプリケーションを作っているとします。<br>
ざっくりとした要件はこんな感じです。</p>

<ol>
<li>プロジェクトを複数管理できる</li>
<li>ひとつのプロジェクトは複数のタスクから構成される</li>
<li>人員を複数管理できる</li>
<li>人員は、色々なプロジェクトのタスクに割り振られる</li>
</ol>

<p>こうすると、集約としては「プロジェクト」と「人員」が出てくるかなと思います。<br>
どちらも「プロジェクトID」と「人員ID」という、グローバル空間で一意なIDを付ければ良さそうです。<br>
また、「タスク」は「プロジェクト」の集約に含まれそうなので、そういったIDは付けません。</p>

<p>ここからが本題なのですが、もしこのアプリケーションをクラウドサービス化したとしたらどうなるでしょうか。<br>
「プロジェクト集約」とか「人員集約」とかは、サービスの契約者ごとに管理されなければなりません。<br>
つまり、「サービス契約者ID」と「プロジェクトID」が揃わなければ、「プロジェクト」が特定できません。</p>

<p>これでは「プロジェクト集約」はグローバルなIDを持たないことになりますが、これは許されるのでしょうか？<br>
あるいは、「プロジェクト集約ルート」は集約ルートからただのエンティティに降格するのでしょうか。</p>

<p>そもそも集約ルートがグローバルなIDで管理されなければならない、というのがいまいちピンときていないのですが・・・<br>
上位の集約のID（上記例ではサービス契約者ID）にぶら下がるのでは、ダメなのでしょうか？<br>
それとも、DDD本にある「グローバルな同一性」とは、単一のIDを要求するものではなく、「サービス契約者ID＋プロジェクトID」という複合的なIDであっても、OKということでしょうか？</p>
