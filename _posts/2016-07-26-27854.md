---
layout: post
title: 配列を引数としたPostgresql配列データ検索方法について
date: 2016-07-26 07:43:56
categories: ruby-on-rails postgresql
---
<p>Ruby on Rails にてWebアプリを作成しております。初学者のため回答に必要な前提条件等が抜けておればご指摘頂けますと幸いです。</p>

<p>ユーザーが指定する条件に基づいてデータベースのテーブルを検索するクエリを作成しているのですが、以下の条件で最も簡潔な書き方をご教示いただけないでしょうか？？</p>

<p>①Postgresqlデータベースの中に配列（ex. ["a", "b", "c"]）が格納されている列があり、この列データと②の検索条件を照合してデータを検索する</p>

<p>②ユーザーが指定した条件（チェックボックスを使用）は配列で取得している状況 ex. ["a", "c"]</p>

<p>①②の配列に格納されるデータ数は必ずしも一致しないが、共に7つという上限あり。</p>

<p>クエリ抽出条件としては、②の配列に含まれる文字のどれか１つでも①の配列に含まれていれば、データを抽出する。</p>

<p>現状、モデル内に以下のようなscopeを記述し、データの抽出を行おうとしています。</p>

<pre><code>scope :search_by_preference, -&gt;(num) { where("? = ANY(preference_num)", num)}
</code></pre>

<p>しかしながら、こちらのプレイスホルダーでは、配列を引数として渡すことができません。<br>
なお、引数が１つ（ユーザーの選択した条件が１つ）のときは問題なくクエリは機能しております。</p>

<p>以上、何卒よろしくお願いします</p>
