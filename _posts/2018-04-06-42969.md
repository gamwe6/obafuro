---
layout: post
title: PostgreSQLでインデックスが破損する原因
date: 2018-04-06 00:03:41
categories: postgresql
---
<!-- {% raw %} -->
<p>PostgreSQLを使っているのですが、まれにインデックスが破損したと見られる現象が発生します。<br>
一部のデータ、というか、一部のキー値を指定した場合のみデータの読み込みに失敗（ブロックのデータが読み込めなかった、という旨のエラー）したり、WHERE句で指定していないデータが返ってきたりすることがあります。<br>
いずれも、REINDEXで直りました。</p>

<p>しかし、REINDEXで直るとは言っても、特に後者のようなケース（エラーではなく、誤った結果を得るケース）は非常に危険ですので、再発防止策を考えなければなりません。<br>
そもそもなぜインデックスが破損するのでしょうか？</p>

<p>例えば、トランザクションの実行中にアプリケーションが停止し、コミットもロールバックもされなかったとして、データとインデックスが中途半端なことになる、そんなことは起きますか？<br>
つまり、DB側ではなく、それを利用するアプリケーション側の問題が原因となる可能性はあるのでしょうか？</p>
<!-- {% endraw %} -->
