---
layout: post
title: "Golangで共通の構造体を複数のDockerコンテナで利用する方法"
date: 2019-07-18 06:04:11
categories: go docker
---
<p>Golangなどの言語を使って、複数のDockerコンテナで連携するようなアプリケーションを作成しています。<br>
そこで質問なのですが、データベースのモデルの構造体など複数のコンテナで共通で利用したいものがあります。そういった場合にどのように実装すればよいのでしょうか。</p>

<p>例えば1つのシステムの中に2つのA,Bというアプリケーションがある場合2つのDockerfileでそれぞれのコンテナを定義しています。この2つのアプリケーションは同様のデータベースにアクセスしているため共通の構造体<code>ModelA</code>を利用します。</p>

<p>現在、それぞれのアプリケーションA,Bに<code>ModelA</code>が定義された<code>model.go</code>を配置しています。<br>
コードが共通なので1つのソースコードで済むようにしたいのですが、どのように実装すればよいのでしょうか。</p>

<p>考えられる方法として、DockerのコンテキストをA,Bの親ディレクトリにしてA,Bのディレクトリの兄弟ディレクトリに共通のライブラリのディレクトリを作成し、そこに<code>model.go</code>を配置する方法があります。<br>
しかしこの方法では例えばコンテナAに必要のないアプリケーションBのソースコードも含まれてしまいます。</p>

<p>もう1つの方法として、共通ライブラリを別のリポジトリにして、ビルド時に<code>go get</code>で取得する方法を考えました。この手法はパブリックリポジトリに共通ライブラリがある場合は簡単に実装できるのですが、プライベートリポジトリの場合は少し複雑になってしまいます。</p>

<p>そこで、現在はそれぞれのコンテナに共通のコードを書くという方法を採用しています。<br>
他に良い方法がありましたらお教えいただけますでしょうか。</p>
