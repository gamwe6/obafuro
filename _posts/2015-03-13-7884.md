---
layout: post
title: char配列から指定バイトだけ切り出したい(memcpyなど使わずに)
date: 2015-03-13 13:21:32
categories: c++ c
---
<!-- {% raw %} -->
<p>この配列に何かバイナリデータが入っているとします。</p>

<pre><code>char c[9]
</code></pre>

<p>これの先頭３バイトをintの変数に入れたいのですが、mem～系の関数を使わずに実現することは可能ですか？<br>
ちなみに４バイト目以降は無傷で残しておきたいです。</p>

<p>【追記】<br>
意味の分かりづらい質問ですいません。<br>
このような感じです。エンディアンに関してはバイトオーダーの関数は後で使って調整できるものとします。なのでとにかくintに入れれば大丈夫です。</p>

<pre><code>int n = 0;
char cc[4] = { 0xe8, 0x03, 0x00, 0x00 }; //数字の1000
memcpy(&amp;n, cc, 3); // 3バイト取り出して1000を復元する
</code></pre>

<p>回答していただいた方々、ありがとうございます。<br>
sanadanさんのコードをベースに下記の方法で数値を復元することができました。</p>

<pre><code>char c[4] = {0x00,0x00,0x06,0x00};  // int6のネットワークバイトオーダー(3バイト目まで)
int x = (*(int *)c) &amp; 0xffffff;  // この時点で0x00,0x06,0x00,0x00になる
x = x &lt;&lt; 8;  // 3桁しか使わない
x = ntohl(x); // オーダー解決
</code></pre>

<p>yoh2さんの方法を使えばバイトオーダーも同時に解決できそうですね。</p>

<p>ご回答していただいた通り、このようなことをするよりも素直にmemcpyを利用しようかとも思っています。</p>

<p>【さらに追記】<br>
よく考えたら任意の場所から取り出して最後の3バイトを取り出す場合もありそうなので、やはり上記コードは使えなさそうです。</p>

<p>最初の意図を明確にしておくと、<br>
インプットデータはネットワークバイトオーダーのバイト配列でした。<br>
それの3バイト目までをintとして扱いたいマシンはリトルエンディアンマシン。。でしたが、この質問を書き、回答を読んで将来ビッグエンディアンで使う可能性もあると思い直しました。<br>
なので、ビットシフトなどは今回の用途では使わない方向でいきます。</p>
<!-- {% endraw %} -->
