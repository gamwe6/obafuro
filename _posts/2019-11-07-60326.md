---
layout: post
title: scriptコマンドなどの操作を記録するコマンドの実行中にviを操作しても、結果ファイルの中身を確認できる方法はありませんか
date: 2019-11-07 10:34:39
categories: linux vim
---
<p><strong>経緯</strong><br>
scriptコマンドで操作履歴を記録中にviコマンドを使用すると、操作履歴に制御コードが含まれており、<code>cat</code>で表示すると<code>cat</code>が異常終了(※)するように見えます。<br>
    ※ Tera Termで実行するときの話です。WSL純正(?)のターミナルでは現象が変わります、ある程度は制御コードを無視してくれますが、一部の制御コードは残ります。<br>
(画面が乱れているので正確なところはわかりません)</p>

<p><strong>質問</strong><br>
viを操作したときも、scriptの記録結果(typescript)を確認できる方法はありませんか？<br>
コマンドは<code>script</code>でなくてもかまいません。</p>

<ul>
<li>vi(vim)の出力する制御コードを無視(または除去)する方法<br>
※viの操作中の履歴はなくなってもかまいません。</li>
<li>制御コードを記録しない方法、<code>ttyrec</code>コマンド等、他のコマンドでもかまいません。</li>
<li>★vi(vim)のような端末の画面制御を行うコマンドの操作をきれいに再現(※)できる方法はありませんか。metropolisさんやfumiyasさんのコメントを参考にして私もいろいろ試してみます。<br>
※操作したときの画面の振る舞いを再生するようなイメージです。</li>
</ul>

<p><strong>実行例</strong></p>

<pre><code>$ script
スクリプトを開始しました。ファイルは typescript です
vi qw.txt
(base) ユーザ名@マシン名:~/work/w051_script$ vi qw.txt
(base) ユーザ名@マシン名:~/work/w051_script$ exit
exit
スクリプトを終了しました。ファイルは typescript です
</code></pre>

<p>viで入力したのは<code>ABC</code>の1行です。</p>

<p><strong>typescriptの内容</strong><br>
<code>od -Ax -c -x  --endian=big ./typescript</code></p>

<pre><code>000000 5363 7269 7074 2073 7461 7274 6564 206f
000010 6e20 3230 3139 2d31 312d 3037 2031 383a
000020 3239 3a31 362b 3039 3030 0a76 6920 7177
000030 2e74 7874 0a28 6261 7365 2920 1b5d 303b
000040 7075 7368 7075 6c6c 4073 3038 3230 316e
000050 3230 3a20 7e2f 776f 726b 2f77 3035 315f
000060 7363 7269 7074 0770 7573 6870 756c 6c40
000070 7330 3832 3031 6e32 303a 7e2f 776f 726b
000080 2f77 3035 315f 7363 7269 7074 2420 7669
000090 2071 772e 7478 740a 1b5b 3f32 3030 3468
0000a0 1b5b 3f31 3034 3968 1b5b 3232 3b30 3b30
0000b0 741b 5b3f 3168 1b3d 1b5b 3f32 3030 3468
0000c0 1b5b 313b 3235 721b 5b3f 3132 681b 5b3f
0000d0 3132 6c1b 5b32 376d 1b5b 3233 6d1b 5b32
0000e0 396d 1b5b 6d1b 5b48 1b5b 324a 1b5b 3f32
0000f0 356c 1b5b 3235 3b31 4822 7177 2e74 7874
000100 2220 5be6 96b0 e383 95e3 82a1 e382 a4e3
000110 83ab 5d1b 5b32 3b31 48e2 96bd 1b5b 366e
000120 1b5b 323b 3148 2020 1b5b 313b 3148 1b5b
000130 3e63 1b5d 3130 3b3f 071b 5d31 313b 3f07
000140 1b5b 313b 3148 1b5b 3333 6d20 2031 201b
000150 5b6d 0d0a 1b5b 316d 1b5b 3334 6d7e 2020
000160 2020 2020 2020 2020 2020 2020 2020 2020
*
0001d0 2020 2020 2020 2020 2020 2020 201b 5b33
0001e0 3b31 487e 2020 2020 2020 2020 2020 2020
0001f0 2020 2020 2020 2020 2020 2020 2020 2020
*
000260 2020 201b 5b34 3b31 487e 2020 2020 2020
000270 2020 2020 2020 2020 2020 2020 2020 2020
*
0002e0 2020 2020 2020 2020 201b 5b35 3b31 487e
0002f0 2020 2020 2020 2020 2020 2020 2020 2020
*
000360 2020 2020 2020 2020 2020 2020 2020 201b
000370 5b36 3b31 487e 2020 2020 2020 2020 2020
000380 2020 2020 2020 2020 2020 2020 2020 2020
*
0003f0 2020 2020 201b 5b37 3b31 487e 2020 2020
000400 2020 2020 2020 2020 2020 2020 2020 2020
*
000470 2020 2020 2020 2020 2020 201b 5b38 3b31
000480 487e 2020 2020 2020 2020 2020 2020 2020
000490 2020 2020 2020 2020 2020 2020 2020 2020
*
000500 201b 5b39 3b31 487e 2020 2020 2020 2020
000510 2020 2020 2020 2020 2020 2020 2020 2020
*
000580 2020 2020 2020 201b 5b31 303b 3148 7e20
000590 2020 2020 2020 2020 2020 2020 2020 2020
*
000600 2020 2020 2020 2020 2020 2020 2020 1b5b
000610 3131 3b31 487e 2020 2020 2020 2020 2020
000620 2020 2020 2020 2020 2020 2020 2020 2020
*
000690 2020 2020 201b 5b31 323b 3148 7e20 2020
0006a0 2020 2020 2020 2020 2020 2020 2020 2020
*
000710 2020 2020 2020 2020 2020 2020 1b5b 3133
000720 3b31 487e 2020 2020 2020 2020 2020 2020
000730 2020 2020 2020 2020 2020 2020 2020 2020
*
0007a0 2020 201b 5b31 343b 3148 7e20 2020 2020
0007b0 2020 2020 2020 2020 2020 2020 2020 2020
*
000820 2020 2020 2020 2020 2020 1b5b 3135 3b31
000830 487e 2020 2020 2020 2020 2020 2020 2020
000840 2020 2020 2020 2020 2020 2020 2020 2020
*
0008b0 201b 5b31 363b 3148 7e20 2020 2020 2020
0008c0 2020 2020 2020 2020 2020 2020 2020 2020
*
000930 2020 2020 2020 2020 1b5b 3137 3b31 487e
000940 2020 2020 2020 2020 2020 2020 2020 2020
*
0009b0 2020 2020 2020 2020 2020 2020 2020 201b
0009c0 5b31 383b 3148 7e20 2020 2020 2020 2020
0009d0 2020 2020 2020 2020 2020 2020 2020 2020
*
000a40 2020 2020 2020 1b5b 3139 3b31 487e 2020
000a50 2020 2020 2020 2020 2020 2020 2020 2020
*
000ac0 2020 2020 2020 2020 2020 2020 201b 5b32
000ad0 303b 3148 7e20 2020 2020 2020 2020 2020
000ae0 2020 2020 2020 2020 2020 2020 2020 2020
*
000b50 2020 2020 1b5b 3231 3b31 487e 2020 2020
000b60 2020 2020 2020 2020 2020 2020 2020 2020
*
000bd0 2020 2020 2020 2020 2020 201b 5b32 323b
000be0 3148 7e20 2020 2020 2020 2020 2020 2020
000bf0 2020 2020 2020 2020 2020 2020 2020 2020
*
000c60 2020 1b5b 3233 3b31 487e 2020 2020 2020
000c70 2020 2020 2020 2020 2020 2020 2020 2020
*
000ce0 2020 2020 2020 2020 201b 5b32 343b 3148
000cf0 7e20 2020 2020 2020 2020 2020 2020 2020
000d00 2020 2020 2020 2020 2020 2020 2020 2020
*
000d70 1b5b 6d1b 5b32 353b 3131 3148 302c 302d
000d80 311b 5b38 43e5 85a8 e381 a61b 5b31 3b35
000d90 481b 5b3f 3235 681b 5b32 376d 1b5b 3233
000da0 6d1b 5b32 396d 1b5b 6d1b 5b48 1b5b 324a
000db0 1b5b 3f32 356c 1b5b 313b 3148 1b5b 3333
000dc0 6d20 2031 201b 5b6d 0d0a 1b5b 316d 1b5b
000dd0 3334 6d7e 2020 2020 2020 2020 2020 2020
000de0 2020 2020 2020 2020 2020 2020 2020 2020
*
000e50 2020 201b 5b33 3b31 487e 2020 2020 2020
000e60 2020 2020 2020 2020 2020 2020 2020 2020
*
000ed0 2020 2020 2020 2020 201b 5b34 3b31 487e
000ee0 2020 2020 2020 2020 2020 2020 2020 2020
*
000f50 2020 2020 2020 2020 2020 2020 2020 201b
000f60 5b35 3b31 487e 2020 2020 2020 2020 2020
000f70 2020 2020 2020 2020 2020 2020 2020 2020
*
000fe0 2020 2020 201b 5b36 3b31 487e 2020 2020
000ff0 2020 2020 2020 2020 2020 2020 2020 2020
*
001060 2020 2020 2020 2020 2020 201b 5b37 3b31
001070 487e 2020 2020 2020 2020 2020 2020 2020
001080 2020 2020 2020 2020 2020 2020 2020 2020
*
0010f0 201b 5b38 3b31 487e 2020 2020 2020 2020
001100 2020 2020 2020 2020 2020 2020 2020 2020
*
001170 2020 2020 2020 201b 5b39 3b31 487e 2020
001180 2020 2020 2020 2020 2020 2020 2020 2020
*
0011f0 2020 2020 2020 2020 2020 2020 201b 5b31
001200 303b 3148 7e20 2020 2020 2020 2020 2020
001210 2020 2020 2020 2020 2020 2020 2020 2020
*
001280 2020 2020 1b5b 3131 3b31 487e 2020 2020
001290 2020 2020 2020 2020 2020 2020 2020 2020
*
001300 2020 2020 2020 2020 2020 201b 5b31 323b
001310 3148 7e20 2020 2020 2020 2020 2020 2020
001320 2020 2020 2020 2020 2020 2020 2020 2020
*
001390 2020 1b5b 3133 3b31 487e 2020 2020 2020
0013a0 2020 2020 2020 2020 2020 2020 2020 2020
*
001410 2020 2020 2020 2020 201b 5b31 343b 3148
001420 7e20 2020 2020 2020 2020 2020 2020 2020
001430 2020 2020 2020 2020 2020 2020 2020 2020
*
0014a0 1b5b 3135 3b31 487e 2020 2020 2020 2020
0014b0 2020 2020 2020 2020 2020 2020 2020 2020
*
001520 2020 2020 2020 201b 5b31 363b 3148 7e20
001530 2020 2020 2020 2020 2020 2020 2020 2020
*
0015a0 2020 2020 2020 2020 2020 2020 2020 1b5b
0015b0 3137 3b31 487e 2020 2020 2020 2020 2020
0015c0 2020 2020 2020 2020 2020 2020 2020 2020
*
001630 2020 2020 201b 5b31 383b 3148 7e20 2020
001640 2020 2020 2020 2020 2020 2020 2020 2020
*
0016b0 2020 2020 2020 2020 2020 2020 1b5b 3139
0016c0 3b31 487e 2020 2020 2020 2020 2020 2020
0016d0 2020 2020 2020 2020 2020 2020 2020 2020
*
001740 2020 201b 5b32 303b 3148 7e20 2020 2020
001750 2020 2020 2020 2020 2020 2020 2020 2020
*
0017c0 2020 2020 2020 2020 2020 1b5b 3231 3b31
0017d0 487e 2020 2020 2020 2020 2020 2020 2020
0017e0 2020 2020 2020 2020 2020 2020 2020 2020
*
001850 201b 5b32 323b 3148 7e20 2020 2020 2020
001860 2020 2020 2020 2020 2020 2020 2020 2020
*
0018d0 2020 2020 2020 2020 1b5b 3233 3b31 487e
0018e0 2020 2020 2020 2020 2020 2020 2020 2020
*
001950 2020 2020 2020 2020 2020 2020 2020 201b
001960 5b32 343b 3148 7e20 2020 2020 2020 2020
001970 2020 2020 2020 2020 2020 2020 2020 2020
*
0019e0 2020 2020 2020 1b5b 6d1b 5b32 353b 3131
0019f0 3148 302c 302d 311b 5b38 43e5 85a8 e381
001a00 a60d 2271 772e 7478 7422 205b e696 b0e3
001a10 8395 e382 a1e3 82a4 e383 ab5d 1b5b 313b
001a20 3548 1b50 2b71 3433 3666 1b5c 1b50 2b71
001a30 3662 3735 1b5c 1b50 2b71 3662 3634 1b5c
001a40 1b50 2b71 3662 3732 1b5c 1b50 2b71 3662
001a50 3663 1b5c 1b50 2b71 3233 3332 1b5c 1b50
001a60 2b71 3233 3334 1b5c 1b50 2b71 3235 3639
001a70 1b5c 1b50 2b71 3261 3337 1b5c 1b50 2b71
001a80 3662 3331 1b5c 1b50 2471 2071 1b5c 1b5b
001a90 3f31 3224 701b 5b3f 3235 681b 5b32 376d
001aa0 1b5b 3233 6d1b 5b32 396d 1b5b 6d1b 5b48
001ab0 1b5b 324a 1b5b 3f32 356c 1b5b 313b 3148
001ac0 1b5b 3338 3b35 3b31 3330 6d20 2031 201b
001ad0 5b6d 0d0a 1b5b 3934 6d7e 2020 2020 2020
001ae0 2020 2020 2020 2020 2020 2020 2020 2020
*
001b50 2020 2020 2020 2020 201b 5b33 3b31 487e
001b60 2020 2020 2020 2020 2020 2020 2020 2020
*
001bd0 2020 2020 2020 2020 2020 2020 2020 201b
001be0 5b34 3b31 487e 2020 2020 2020 2020 2020
001bf0 2020 2020 2020 2020 2020 2020 2020 2020
*
001c60 2020 2020 201b 5b35 3b31 487e 2020 2020
001c70 2020 2020 2020 2020 2020 2020 2020 2020
*
001ce0 2020 2020 2020 2020 2020 201b 5b36 3b31
001cf0 487e 2020 2020 2020 2020 2020 2020 2020
001d00 2020 2020 2020 2020 2020 2020 2020 2020
*
001d70 201b 5b37 3b31 487e 2020 2020 2020 2020
001d80 2020 2020 2020 2020 2020 2020 2020 2020
*
001df0 2020 2020 2020 201b 5b38 3b31 487e 2020
001e00 2020 2020 2020 2020 2020 2020 2020 2020
*
001e70 2020 2020 2020 2020 2020 2020 201b 5b39
001e80 3b31 487e 2020 2020 2020 2020 2020 2020
001e90 2020 2020 2020 2020 2020 2020 2020 2020
*
001f00 2020 201b 5b31 303b 3148 7e20 2020 2020
001f10 2020 2020 2020 2020 2020 2020 2020 2020
*
001f80 2020 2020 2020 2020 2020 1b5b 3131 3b31
001f90 487e 2020 2020 2020 2020 2020 2020 2020
001fa0 2020 2020 2020 2020 2020 2020 2020 2020
*
002010 201b 5b31 323b 3148 7e20 2020 2020 2020
002020 2020 2020 2020 2020 2020 2020 2020 2020
*
002090 2020 2020 2020 2020 1b5b 3133 3b31 487e
0020a0 2020 2020 2020 2020 2020 2020 2020 2020
*
002110 2020 2020 2020 2020 2020 2020 2020 201b
002120 5b31 343b 3148 7e20 2020 2020 2020 2020
002130 2020 2020 2020 2020 2020 2020 2020 2020
*
0021a0 2020 2020 2020 1b5b 3135 3b31 487e 2020
0021b0 2020 2020 2020 2020 2020 2020 2020 2020
*
002220 2020 2020 2020 2020 2020 2020 201b 5b31
002230 363b 3148 7e20 2020 2020 2020 2020 2020
002240 2020 2020 2020 2020 2020 2020 2020 2020
*
0022b0 2020 2020 1b5b 3137 3b31 487e 2020 2020
0022c0 2020 2020 2020 2020 2020 2020 2020 2020
*
002330 2020 2020 2020 2020 2020 201b 5b31 383b
002340 3148 7e20 2020 2020 2020 2020 2020 2020
002350 2020 2020 2020 2020 2020 2020 2020 2020
*
0023c0 2020 1b5b 3139 3b31 487e 2020 2020 2020
0023d0 2020 2020 2020 2020 2020 2020 2020 2020
*
002440 2020 2020 2020 2020 201b 5b32 303b 3148
002450 7e20 2020 2020 2020 2020 2020 2020 2020
002460 2020 2020 2020 2020 2020 2020 2020 2020
*
0024d0 1b5b 3231 3b31 487e 2020 2020 2020 2020
0024e0 2020 2020 2020 2020 2020 2020 2020 2020
*
002550 2020 2020 2020 201b 5b32 323b 3148 7e20
002560 2020 2020 2020 2020 2020 2020 2020 2020
*
0025d0 2020 2020 2020 2020 2020 2020 2020 1b5b
0025e0 3233 3b31 487e 2020 2020 2020 2020 2020
0025f0 2020 2020 2020 2020 2020 2020 2020 2020
*
002660 2020 2020 201b 5b32 343b 3148 7e20 2020
002670 2020 2020 2020 2020 2020 2020 2020 2020
*
0026e0 2020 2020 2020 2020 2020 2020 1b5b 6d1b
0026f0 5b32 353b 3131 3148 302c 302d 311b 5b38
002700 43e5 85a8 e381 a60d 2271 772e 7478 7422
002710 205b e696 b0e3 8395 e382 a1e3 82a4 e383
002720 ab5d 1b5b 313b 3548 1b50 2b71 3662 3332
002730 1b5c 1b50 2b71 3662 3333 1b5c 1b50 2b71
002740 3662 3334 1b5c 1b50 2b71 3662 3335 1b5c
002750 1b50 2b71 3662 3336 1b5c 1b50 2b71 3662
002760 3337 1b5c 1b50 2b71 3662 3338 1b5c 1b50
002770 2b71 3662 3339 1b5c 1b5b 3f32 3568 1b50
002780 2b71 3662 3362 1b5c 1b50 2b71 3436 3331
002790 1b5c 1b50 2b71 3436 3332 1b5c 1b50 2b71
0027a0 3235 3331 1b5c 1b50 2b71 3236 3338 1b5c
0027b0 1b50 2b71 3662 3632 1b5c 1b50 2b71 3662
0027c0 3439 1b5c 1b50 2b71 3662 3434 1b5c 1b50
0027d0 2b71 3662 3638 1b5c 1b50 2b71 3430 3337
0027e0 1b5c 1b50 2b71 3662 3530 1b5c 1b50 2b71
0027f0 3662 3465 1b5c 1b50 2b71 3462 3331 1b5c
002800 1b50 2b71 3462 3333 1b5c 1b50 2b71 3462
002810 3334 1b5c 1b50 2b71 3462 3335 1b5c 1b50
002820 2b71 3662 3432 1b5c 1b5b 3f32 356c 1b5b
002830 3235 3b31 481b 5b31 6d2d 2d20 e68c bfe5
002840 85a5 202d 2d1b 5b6d 1b5b 3235 3b31 3148
002850 1b5b 4b1b 5b32 353b 3131 3148 302c 311b
002860 5b31 3043 e585 a8e3 81a6 1b5b 313b 3548
002870 1b5b 3f32 3568 1b5b 3f32 356c 411b 5b32
002880 353b 3131 3148 312c 321b 5b31 3b36 481b
002890 5b3f 3235 681b 5b3f 3235 6c42 1b5b 3235
0028a0 3b31 3133 4833 1b5b 313b 3748 1b5b 3f32
0028b0 3568 1b5b 3f32 356c 431b 5b32 353b 3131
0028c0 3348 341b 5b31 3b38 481b 5b3f 3235 681b
0028d0 5b32 353b 3148 1b5b 4b1b 5b31 3b37 481b
0028e0 5b3f 3235 6c1b 5b32 353b 3131 3148 312c
0028f0 331b 5b31 3043 e585 a8e3 81a6 1b5b 313b
002900 3748 1b5b 3f32 3568 1b5b 3f32 3030 346c
002910 1b5b 3f32 356c 1b5b 3235 3b31 4822 7177
002920 2e74 7874 221b 5b32 353b 3131 3148 1b5b
002930 4b1b 5b32 353b 3130 485b e696 b05d 2031
002940 4c2c 2034 4320 e69b b8e8 bebc e381 bf0d
002950 0d0a 1b5b 3f32 3030 346c 1b5b 3f31 6c1b
002960 3e1b 5b3f 3235 681b 5b3f 3130 3439 6c1b
002970 5b32 333b 303b 3074 2862 6173 6529 201b
002980 5d30 3b70 7573 6870 756c 6c40 7330 3832
002990 3031 6e32 303a 207e 2f77 6f72 6b2f 7730
0029a0 3531 5f73 6372 6970 7407 7075 7368 7075
0029b0 6c6c 4073 3038 3230 316e 3230 3a7e 2f77
0029c0 6f72 6b2f 7730 3531 5f73 6372 6970 7424
0029d0 2065 7869 740a 6578 6974 0a0a 5363 7269
0029e0 7074 2064 6f6e 6520 6f6e 2032 3031 392d
0029f0 3131 2d30 3720 3138 3a32 393a 3534 2b30
002a00 3930 300a
002a04
</code></pre>

<p><strong>環境</strong><br>
VIM - Vi IMproved 8.0 (2016 Sep 12, compiled Jun 06 2019 17:31:41)適用済パッチ: 1-1453<br>
script from util-linux 2.31.1</p>
