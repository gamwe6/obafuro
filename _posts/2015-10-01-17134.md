---
layout: post
title: 絵文字を格納したいが　?????　になる
date: 2015-10-01 05:36:41
categories: java android mariadb jdbc
---
<!-- {% raw %} -->
<p>アプリ　JavaDataInputStream　JDBC-MariaDB　MariaDB<br>
の順で絵文字を格納したいのですが、格納される文字が　?????　になります。（絵文字部分だけ）<br>
全ての絵文字がそうなるわけではなく、サロゲートペアのものがそうなります。<br>
もちろん通常の文字だけなら普通に格納されます。</p>

<p>データベースのテーブルは　utf8mb4　で、カラムも　utf8mb4　であることを確認しています。<br>
useUnicode=true&amp;characterEncoding=utf8mb4　をつけてコネクションを取得しています。</p>

<p>試しに　set names utf8mb4　も試しましたがこれもダメでした。</p>

<p>何をしても　???　で保存されてしまうのですが何処が行けないのでしょうか？</p>

<p>追記<br>
やはり解決できません</p>

<p>□絶対だと分かっていること<br>
・テーブルは正常にutf8mb4である<br>
カラム単位でチェック済み<br>
これをする前は例外が発生していたが、これをしてから例外は発生しなくなった。<br>
そもそも、コネクションを通さなければ格納できる。</p>

<p>・コネクションは1.2.3（mariadb java）<br>
サロゲートペアが？になるバグは修正されているとここでの解答してくださった方により判明</p>

<p>・アプリ　←→　サーバー　の通信はうまく行われている。<br>
DBに格納しないでそのままエコーすると正常に表示される。</p>

<p>・悪いのは　MariaDB　コネクション<br>
ターミナルなどではサロゲートペアでも普通に格納できる。<br>
また、PrepareStatementを使用している点が怪しい？<br>
（？をエスケープして置換してくれるやつ）</p>

<p>・コネクションには以下を指定（うるおぼえ）<br>
useUtf=tru　charset=utf8mb4</p>

<p>・MariaDBにデータが届いた時点で文字化けではなくそもそも　？　という文字に置き換わっていると思われる。<br>
やはり、コネクションでの変換が原因？</p>

<p>要するに悪いのは絶対　MariaDB　Connection Java　だと思われるのですが、とても困っています。</p>

<p>追記追記<br>
対応できました！！！！！！！！！！！！<br>
原因　SQLの関数　ストアドプロシージャ　の　client_character　的なのが　utf-8　だった。</p>
<!-- {% endraw %} -->
