---
layout: post
title: 検索エンジンの実装方法について(like検索、full-text indexなどなど)
date: 2017-10-03 06:26:23
categories: ruby-on-rails mysql aws elasticsearch
---
<p>下記を実現するにはどうやるのがよいでしょうか？<br>
自分なりに考えた実現方法案も後述しましたので、それらも参考にしていただけると幸いです。<br>
よろしくお願いします。</p>

<h2>やりたいこと</h2>

<p>APIのパラメーターで文字列を渡す。それをキーにテキストリストから検索をしたい。<br>
具体的には、「とう」や「tok」、「東」というインプットにたいして、<br>
後述の都道府県リストから「東京」という結果を取得したい。<br>
「とう」のときに「糖分」がひっかかるのはOK</p>

単語リスト

<p>東京<br>
京都<br>
大阪<br>
北海道<br>
福岡<br>
糖分</p>

<p>※ 文章ではなくて、すでに単語レベルにパースされてるという前提で大丈夫です<br>
※ レコード数は多くても数百(パフォーマンスは問題にならないかと）</p>

<h2>環境</h2>

<p>Rails 4.2.6<br>
AWS EC2 + RDS for MYSQL 5.7</p>

<h2>実現方法案</h2>

<ol>
<li><p>普通にMySQLでlike検索<br>
「東」と入力しないとひっかからない<br>
平仮名、アルファベットのカラムを用意してそこからもlike検索をすれば、<br>
平仮名でもアルファベットでもOK?<br>
※ レコード数は多くないので、速度は気にしません。<br>
※ kakasiが使えそう</p></li>
<li><p>MySQL5.7でのfull-text index<br>
1と同様で、平仮名、アルファベット、漢字のそれぞれの転置インデックスを作らないとダメ。<br>
※ 参考までに、RDSではNグラムパーサーしか使えません。</p></li>
<li><p>Elastic search<br>
いれるのが大変そう(試してない）。今回はそこまでコストかけずに実装したい<br>
Kuromojiをいれれば、漢字と読みの紐付けはできる</p></li>
<li><p>他になにかあれば</p></li>
</ol>

<h3>その他</h3>

<p>googleだと検索する時に「とうky」などといれても東京がサジェストされるのですが、<br>
いったい彼らはどうやって実装してるんですかね。。。</p>
