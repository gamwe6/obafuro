---
layout: post
title: "HTTP_X_FORWARDED_FORに時々入る値"
date: 2016-09-21 16:52:08
categories: php aws
---
<p>AWSロードバランサー経由でのクライアントのipアドレスを下記方法で取得しています。</p>

<pre><code>$ips = isset($_SERVER['HTTP_X_FORWARDED_FOR']) ? $_SERVER['HTTP_X_FORWARDED_FOR'] : false;
if ($ips) {
    $ip = explode(',', $ips)[0];
}
</code></pre>

<p>この <code>$ip</code> は99%以上の確率で正しい値が取得出来ているのですが、1%弱の確率で下記形式が入っていることがあります。</p>

<pre><code>xxxxxx xxx.xxx.xxx.xxx 
// xは全て数値、(6桁の数字)半角スペース(ipアドレス)
</code></pre>

<p>6桁の数字は特に規則性も無いようで、00....から始まるものもあれば、90....の様なものもあります。（しいてあげれば、0.....で始まるものと9.....で始まるものが多い模様）<br>
また、この時のipアドレスは172.31.xxx.xxの様なプライベートアドレスになっています。</p>

<p>これはどのような状況なのか、わかる方がいらっしゃいましたら教えて頂けますでしょうか。<br>
また、この6桁の数字は何ですか？<br>
この時にクライアントのipアドレスは取得出来ますか？<br>
よろしくお願いします。</p>
