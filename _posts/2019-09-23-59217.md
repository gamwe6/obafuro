---
layout: post
title: サーバーのプライベートip127.0.0.1がローカルマシンの127.0.0.1を指すことがある件
date: 2019-09-23 08:09:32
categories: nginx サーバー管理 サーバ通信
---
<p>サーバーでnode.jsのアプリを動かすと度々このような自体に見舞われます。<br>
フレームワークはnuxt.jsです。</p>

<p>そもそも127.0.0.1というのはマシン内部のプライベートなipであり<br>
グローバルipとは違うはずだと思うのですが</p>

<p>例えばローカルマシンの127.0.0.1:4000でapサーバーを起動させている間<br>
サーバーにデプロイしているアプリ127.0.0.1:3000から127.0.0.1:4000へリクエストすると<br>
ローカルマシン上で稼働させている127.0.0.1:4000のアプリにリクエストが飛んできます。</p>

<p>正直、どういう理屈なのか全くわかりません。<br>
そもそも、サーバー内では127.0.0.1:3000はnginxで公開しています。<br>
127.0.0.1:4000は公開していません。<br>
リバースプロキシをやって公開しているのは127.0.0.1:3000だけです。</p>

<p>そもそも何がやりたいというと<br>
127.0.0.1:4000のapiは誰彼構わず叩かれたくないので<br>
公開したくないのです。<br>
ただし127.0.0.1:3000のアプリからだけは利用したい</p>

<p>サーバー内のlocalhostを<br>
同サーバーから公開されているアプリのみ利用可能とする方法は無いのでしょうか？</p>

<p>なに分、元々フロントエンドエンジニアなもので<br>
サーバーのその辺の事情が分かっていません。</p>

<p>安全性から言ったら当然、公開するサーバー、非公開でlocalhostとしてだけ動かすサーバーという<br>
構成でアプリは運用できるものと思っていたのですが<br>
違うのでしょうか？</p>

<p>127.0.0.1:3000のアプリで<br>
127.0.0.1:4000のapiを叩かせようと思ったら<br>
やはり127.0.0.1:4000のapiも公開した上で<br>
nginxの設定やらで同サーバーからのみ利用可能な設定にしてやらなければならないのでしょうか？</p>

<p>もはやlocalhostがなぜこのような仕組みになっているのか<br>
わけが分からないです。</p>

<p>詳しい方ご教示頂けないでしょうか？<br>
よろしくお願いします。</p>
