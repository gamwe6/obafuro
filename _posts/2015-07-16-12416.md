---
layout: post
title: Node.jsのメモリリークの対策について
date: 2015-07-16 10:53:13
categories: node.js socket.io
---
<!-- {% raw %} -->
<p>こんにちは。</p>

<p>現在、私はNode.js×socket.ioを利用してリアルタイム通信用のサーバーを構築しています。<br>
Node.jsもsocket.ioも今回が初めての初心者です。<br>
Node.jsのプロセス管理にはpm2を利用しています。</p>

<p>Node.js v0.12.2<br>
socket.io v0.9.17<br>
pm2 v0.14.2</p>

<p>先日、完成したサーバーに対して負荷テストを実施したところ、<br>
負荷をかけている最中はメモリ利用量がどんどん上昇していき、負荷をかけ終わったにも関わらずメモリ利用量が変わらないという状態になりました。</p>

<p>調べてみると、ソースコード上からGCを実行できることを発見したため試してみました。</p>

<pre><code>global.gc();
</code></pre>

<p>きちんと上記のコードは実行されることを確認出来ましたが、対してメモリ利用量は変わりませんでした。</p>

<p>起動時 40MB程度<br>
 負荷テスト終わった後 80MB程度<br>
 GCが走った後 75MB程度</p>

<p>本当はソースコードを示せればいいのですが、事情で示すことが出来ません。<br>
これは、ソースコードが悪いのでしょうか（GCで回収されないものがある）、それともこんなものなのでしょうか。</p>

<p>情報があまりないのですが、心当たり程度でもありがたいのでご教授いただけると助かります。<br>
よろしくお願い致します。</p>
<!-- {% endraw %} -->
