---
layout: post
title: "API で一定時間後に非同期処理を行うベストプラクティス"
date: 2019-08-30 03:45:40
categories: php aws fuelphp aws-lambda
---
<p>EC2 で動いてる Fuel API サーバーで<br>
ユーザからリクエストが来た後一定時間経過後に処理(RDS上のMySQLを更新)というようなことがやりたいです<br>
ただ API なのでユーザにはすぐに返答を返す必要があるため<br>
非同期で処理をしたいのですがそういう機能はあったりしますか？<br>
単に PHP で fork とか thread とかで分岐してしまえばいいのでしょうか</p>

<p>あと Fuel で単独でできない場合 AWS のサービスでタイマー実行を低コストで簡単に行えるものはないですか？</p>

<p>使ったことがあるのが EC2,  Lambda,  API Gateway ぐらいなので<br>
API Gateway 経由で Lambda を起動して Lambda 内で一定時間 sleep してから処理をする<br>
ぐらいしか思いつかないんですが</p>

<p>非同期タイマー処理を行ういい方法があれば教えていただきたいです</p>

<h1>追記</h1>

<p>リクエストを受けてから例えば 5 分後に処理を行いたくて<br>
パラメータをどこかにためておいて<br>
5 分ごとに cron で一斉処理だと<br>
リクエストから 2 分だったり 3 分だったりで処理されるのでNGです</p>

<h1>追記</h1>

<p>さらに終了時の MySQL の状態に応じて能動的にサーバーからユーザにアクションを行いたいので<br>
単に制限時間を MySQL に覚えておいて次にリクエストにきたときに<br>
時間切れかどうかを判定するみたいなこともできません<br>
とにかく「非同期で一定時間後に処理を行う」ということがしたいです</p>
