---
layout: post
title: ダブルクォーテーション含む文字列をスペースで分割するには
date: 2016-09-01 00:43:42
categories: java 正規表現
---
<p>全文検索用にユーザー様がキーワードをGoogle検索のように、1つや、複数入力した場合、各キーワードを分割する方法を探しています。</p>

<p>半角及び全角スペースで区切られた下記の様な文字列を分割したいのですが、<br>
正規表現がわかりません。</p>

<h3>分割条件</h3>

<ol>
<li>半角、全角、スペース区切り。</li>
<li>但し、ダブルクォーテーションで括られている文字列は中にスペースやタブなどの特殊文字が入っていても一つの文字列として扱う。<br>
従って、<br>
『ABC あいう"え "" おか きく"けこ -"おはよう"』を分割すると、<br>
『ABC』<br>
『あいう"え "" おか きく"けこ』 ← 途中に ""があるが、" "と間にスペースがないので連続した文字列と判断。<br>
『 -"おはよう"』<br>
の３つになります。</li>
</ol>

<h3>元の文字列の例</h3>

<p><code>　きた　A+!^"*-= "　P" 雨 "" 雪 "　　　"み　　ず た    に"　　　　abc　時間123-"門`限"　 "やぶるな</code></p>

<p>Java文字列リテラル表現では:</p>

```
String moto = "　きた　A+!^\"*-= \"　P\" 雨 \"\" 雪 \"　　　\"み　　ず た    に\"　　　　abc　時間123-\"門`限\"　 \"やぶるな";
```

<h3>分割後の各文字列</h3>

<ul>
<li><code>きた</code></li>
<li><code>A+!^"*-= "</code></li>
<li><code>P" 雨 "" 雪 "</code></li>
<li><code>"み　　ず た    に"</code></li>
<li><code>abc</code></li>
<li><code>時間123-"門限"</code></li>
<li><code>"やぶるな</code>　←わざと最後のダブルクォーテーションを外してあります。</li>
</ul>

<p>下記正規表現でできる？かもしれませんが、このコードをJAVAへ記述すると、<br>
 実行以前の問題で、eclipsで記述文字列が正しくないエラーで赤く指摘状態になります。<br>
（恐らく<code>\</code>を追加したりしてエスケープ処理をしないといけないのですが、<code>\</code>を<code>/</code>や<code>"</code>の前にいくつ追加しても、文字列が正しくないというエラーで赤く指摘状態になります。）</p>

```
Pattern p = Pattern.compile("\s+("(?:"|[^"])*"?|[^"]\S*)");
String[] result = p.split(moto);
for (int i=0; i&lt;result.length; i++){
    System.out.println("[" + result[i] + "]");
}
```

<h3>質問 １</h3>

<p>正規表現は、正しいでしょうか？</p>

<h3>質問 ２</h3>

<p>Javaに記述するには、\を追加などして、どのように記述すれば、Eclipseが文字列が不正というエラーをださなくなるでしょうか？</p>

<p>やった見ている多数のパターンの一例ですが、</p>

```
Pattern p = Pattern.compile("\\s+(\"(?:\"|[^\"])*\"?|[^\"]\S*)");
```

<hr>

<p>下記の様に \ を入れたところ、eclipsで赤文字で、文字列エラーがなくなりました。</p>

```
String[] result = test.split("\\s+(\"(?:\"|[^\"])*\"?|[^\"]\\S*)");
for (int i=0; i&lt;result.length; i++){
    out.print("[" + result[i] + "]");
}
```

<p>但し、正規表現が悪いようで、下記の様に分割できませんでした。<br>
<code>test = "雨 "み ず"";</code><br>
　↓ 分割後<br>
<code>[雨 "み ず"]</code></p>
