---
layout: post
title: "mysqlで更新クエリの多いテーブルにカラム追加したらＤＢ負荷が高まりサイトが落ちました。"
date: 2017-02-28 23:23:39
categories: mysql
---
<p>PHP+mysqlでwebサービス稼働中なのですが、更新クエリ（トランザクション）が多く発行されるテーブルに対し日中、ALTER TABLEでカラム1件を追加したところ、DB負荷が高まりサイトアクセスできなくなり、mysqlを再起動せざるを得ない状態となりました。</p>

<p><a href="http://nippondanji.blogspot.jp/2009/05/alter-table.html" rel="nofollow noreferrer">漢のコンピュータ道氏のサイト</a>によりますと以下のように書かれてあり、これは負荷かかるだろうなと思いました。</p>

<blockquote>
  <p>まず結論から言うと、なんとMySQLのALTER<br>
  TABLEはテーブルのデータを全てコピーし直すのである。なんて無駄なことを！？と思うかも知れないが、テーブル定義（スキーマ）の変更を動的に行うには、ストレージエンジンによるサポートが必要であり、動的なスキーマ変更をサポートしているストレージエンジンはまだ少ないのである。</p>
</blockquote>

<p>みなさんはサービス稼働中のサイトにどのようにALTER TABLEを実行していますか？<br>
サービスを止めたりしていますか？または深夜に行う等</p>

<p>■バージョン情報<br>
バージョン：5.1.73<br>
ストレージエンジン：INNODB</p>
