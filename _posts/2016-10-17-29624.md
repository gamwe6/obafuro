---
layout: post
title: cakephp Excelが開けない
date: 2016-10-17 06:31:19
categories: php cakephp excel com
---
<!-- {% raw %} -->
<p>CakePHPのシステムでExcelの帳票出力を行っているのですが、<br>
帳票出力の元となるExcelファイルが開けずに困っています。</p>

<p>帳票出力自体はPHPのシェルスクリプトとなっていて、<br>
コマンドを実行してバックグラウンドで帳票ファイルを作成するのですが、<br>
直接コマンドを実行するとファイルが作成されるのに、PHPからコマンドを実行すると</p>

<p>$hoge->Workbooks->Open($filepath)</p>

<p>の実行でタイムアウトとなってしまいます。</p>

<p>動かしているサーバーはWindows7なのですが、<br>
タイムアウトとなった状況でプロセスを確認すると<br>
Excelのプロセスが動いたままとなり、そのプロセスを終了させると、</p>

<p>　　エラーコード：-2147023170</p>

<p>エラーメッセージ：Error [0x800706be] リモート プロシージャ コールに失敗しました。</p>

<p>と表示されます。</p>

<p>以前に別の理由でExcelファイルが開けず帳票出力ができなかったときは、<br>
C:\Windows\System32\config\systemprofile\ 上に"Desktop"フォルダを作成することで<br>
帳票出力まで問題なく完了していたのですが、</p>

<p>別の修正を行っているうちにこのような状況になってしまいました。<br>
(別修正を戻しても状況は変わりませんでした。)</p>

<p>正直に言って、私ではもう手詰まり状態です。</p>

<p>状況の原因、対応について、何かご存知の方がいらっしゃったら<br>
ご教授をお願いできませんでしょうか。</p>

<p>以上、よろしくお願いいたします。</p>
<!-- {% endraw %} -->
