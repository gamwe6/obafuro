---
layout: post
title: "mysql で deadlock が発生した場合、暗黙的なコミットが発生しているように見えますが、認識は正しいですか?"
date: 2018-12-12 07:36:15
categories: mysql
---
<p><strong>追記</strong></p>

<p>調査の結果、掲題の認識は誤っており、暗黙的なコミットは発生しておりませんでした。<br>
そのため、本稿は、有意義な質問ではありません。<br>
但し、ありがたいことに回答を頂いているため、削除は行わず、コミュニティによる削除を待たせていただければと思います。</p>

<hr>

<p>2つのセッション(セッションA と セッションB)で deadlock が発生し、セッションBが rollback されたときに、セッションA では、暗黙的なコミットが発生しているように見えます。</p>

<p>この認識が正しいか、確証が持てないのですが、どこかに仕様の記載があるか、ご存知の方はいらっしゃいませんでしょうか?</p>

<p><a href="https://dev.mysql.com/doc/refman/5.6/ja/innodb-deadlock-detection.html" rel="nofollow noreferrer">MySQL :: MySQL 5.6 リファレンスマニュアル :: 14.2.10 デッドロックの検出とロールバック</a> によれば、</p>

<blockquote>
  <p>InnoDB では、自動的にトランザクションのデッドロックが検出され、デッドロックを解除するためにトランザクション (複数の場合あり) がロールバックされます。</p>
</blockquote>

<p>とあります。</p>

<p>また、 <a href="https://dev.mysql.com/doc/refman/5.6/ja/implicit-commit.html" rel="nofollow noreferrer">MySQL :: MySQL 5.6 リファレンスマニュアル :: 13.3.3 暗黙的なコミットを発生させるステートメント</a> では、<code>トランザクション制御およびロックステートメント</code> により、暗黙的なコミットが発生する、と記載がありました。</p>

<p>セッションBはロールバックされ、セッションAは、トランザクション制御によりコミットされているのでしょうか?</p>

<p>アプリケーションコードとしては、明示的に Commit していないのに、デッドロックを起因として Commit されるとしたら、意外と気づかないのではないか、と考え、仕様を確認したく、質問しました。</p>
