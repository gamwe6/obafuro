---
layout: post
title: 例えば Python からテキストファイルの編集を行いたいが，保存時1行ずつ一時ファイルに書き込む以外にうまい方法はあるか
date: 2015-04-28 02:53:13
categories: python テキストファイル
---
<!-- {% raw %} -->
<p>テキストファイルがあり，それの編集，例えば文字列置換をしたいとします．具体的に</p>

<ul>
<li>6 を 9 にすべて置換したい</li>
</ul>

<p><code>sed</code> でも <code>vim -c '%s/6/9/g' -c ':wq' origfile</code> でもできるでしょうが，実際の処理はもう少し複雑で，<del><code>sed</code> は turing complete とはいえ </del> たとえば Python で処理全体を書きたいです．[回答は Python 以外の言語についてでも大丈夫です]</p>

<p>この場合に，（元の文字列）→（処理後の文字列）の変換は問題なく書けますが，その結果をファイルに反映する処理をどうするのがよいのか迷っています．「一行ごと（でも何でも）元のファイルを読み込み，処理後の文字列を全部一時ファイルに書き込み，<code>mv tempfile original</code>」というのが唯一思いつく（そしてきちんと動く）方法なのですが，必ずファイルを全コピー相当になってしまうのが無駄が多いような気もしてしまいます．ごくごく直観的，そしてナイーブには変更のあったところだけ書き込みたい(原理的に無理な気がしてきていますが)．底まで行かずともなにかうまい方法はありませんか，それともこれで正しいやり方なのでしょうか．</p>
<!-- {% endraw %} -->
